<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Go 语言从入门到实战 | 梁嘉嘉の博客</title><meta name="author" content="SolisAmicus"><meta name="copyright" content="SolisAmicus"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="编写第一个 Go 程序 下载和安装 最新版：https:&#x2F;&#x2F;go.dev&#x2F;doc&#x2F;install 以往版本：https:&#x2F;&#x2F;golang.google.cn&#x2F;dl&#x2F; 🌟项目名：go_learning 基本程序结构 ⭐src\ch1\main hello_world.go： 12345678package mainimport &quot;fmt&quot;func main() {	fmt.Println(&quot;Hel">
<meta property="og:type" content="article">
<meta property="og:title" content="Go 语言从入门到实战">
<meta property="og:url" content="https://solisamicus.github.io/programming-language/go/Go%20%E8%AF%AD%E8%A8%80%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/index.html">
<meta property="og:site_name" content="梁嘉嘉の博客">
<meta property="og:description" content="编写第一个 Go 程序 下载和安装 最新版：https:&#x2F;&#x2F;go.dev&#x2F;doc&#x2F;install 以往版本：https:&#x2F;&#x2F;golang.google.cn&#x2F;dl&#x2F; 🌟项目名：go_learning 基本程序结构 ⭐src\ch1\main hello_world.go： 12345678package mainimport &quot;fmt&quot;func main() {	fmt.Println(&quot;Hel">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://solisamicus.github.io/images/programming-language/go/golang-logo.png">
<meta property="article:published_time" content="2023-11-01T00:30:00.000Z">
<meta property="article:modified_time" content="2023-11-25T14:40:00.000Z">
<meta property="article:author" content="SolisAmicus">
<meta property="article:tag" content="Go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://solisamicus.github.io/images/programming-language/go/golang-logo.png"><link rel="shortcut icon" href="/./img/favicon.png"><link rel="canonical" href="https://solisamicus.github.io/programming-language/go/Go%20%E8%AF%AD%E8%A8%80%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: SolisAmicus","link":"链接: ","source":"来源: 梁嘉嘉の博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Go 语言从入门到实战',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-25 22:40:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../../../images/programming-language/go/golang-logo.png')"><nav id="nav"><span id="blog-info"><a href="/" title="梁嘉嘉の博客"><img class="site-icon" src="/./img/logo.png"/><span class="site-name">梁嘉嘉の博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Go 语言从入门到实战</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-01T00:30:00.000Z" title="发表于 2023-11-01 08:30:00">2023-11-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-25T14:40:00.000Z" title="更新于 2023-11-25 22:40:00">2023-11-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Programming-Language/">Programming Language</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Programming-Language/Go/">Go</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Go 语言从入门到实战"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="编写第一个-go-程序">编写第一个 Go 程序</h2>
<p>下载和安装</p>
<p>最新版：<a target="_blank" rel="noopener" href="https://go.dev/doc/install">https://go.dev/doc/install</a></p>
<p>以往版本：<a target="_blank" rel="noopener" href="https://golang.google.cn/dl/">https://golang.google.cn/dl/</a></p>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>🌟</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f31f.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>项目名：<code>go_learning</code></p>
<h2 id="基本程序结构">基本程序结构</h2>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch1\main</i></p>
<p><code>hello_world.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	fmt.Println(<span class="string">"Hello World"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>获取退出返回值：<code>os.Exit</code></p>
<p>获取命名行参数：<code>os.Args</code></p>
<p>测试程序要求：</p>
<ul>
<li>测试文件：<code>xxx_test.go</code></li>
<li>测试方法：<code>func TestXXX(t *testing.T){...}</code></li>
</ul>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch2\test</i></p>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>1⃣</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>first_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> try_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFirstTry</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	t.Log(<span class="string">"My first try!"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestFirstTry<br>
h:\go_learning\src\ch2\test\first_test.go:6: My first try!<br>
— PASS: TestFirstTry (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch2/test">cs.liangjiajia.com/ch2/test</a>     (cached)</p>
</blockquote>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>2⃣</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>second_test.go</code>：</p>
<p>实现 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Fibonacci</mtext></mrow><annotation encoding="application/x-tex">\text {Fibonacci}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Fibonacci</span></span></span></span></span> 数列：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mtext>，</mtext></mrow><annotation encoding="application/x-tex">8，</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">8</span><span class="mord cjk_fallback">，</span></span></span></span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>13</mn></mrow><annotation encoding="application/x-tex">13</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">3</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.31em;vertical-align:0em;"></span><span class="minner">⋯</span></span></span></span></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> try_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSecond</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	a := <span class="number">1</span></span><br><span class="line">	b := <span class="number">1</span></span><br><span class="line">	fmt.Print(a, <span class="string">" "</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">		fmt.Print(<span class="string">" "</span>, b)</span><br><span class="line">		tmp := a + b</span><br><span class="line">		a = b</span><br><span class="line">		b = tmp</span><br><span class="line">	}</span><br><span class="line">	fmt.Println()</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSecond<br>
1  1 2 3 5 8 13 21 34 55 89<br>
— PASS: TestFibonacci (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch2/test">cs.liangjiajia.com/ch2/test</a>     1.428s</p>
</blockquote>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>📌</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>其他变量命名方法：</p>
<ul>
<li><code>var x int = a</code></li>
<li><code>var (x int = a y int = b ...)</code></li>
<li><code>var (x = a y = b ...)</code></li>
<li><code>var a int</code> + <code>a = 1</code></li>
</ul>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>3⃣</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>third_test.go</code>：</p>
<p>实现两数交换：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mtext>&nbsp;</mtext><mo>↔</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">1 \ \leftrightarrow 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace">&nbsp;</span><span class="mrel">↔</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> try_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestThirdTry</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	a := <span class="number">1</span></span><br><span class="line">	b := <span class="number">2</span></span><br><span class="line">	t.Log(a, b)</span><br><span class="line">	a, b = b, a</span><br><span class="line">	t.Log(a, b)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestThirdTry<br>
h:\go_learning\src\ch2\test\third_test.go:8: 1 2<br>
h:\go_learning\src\ch2\test\third_test.go:10: 2 1<br>
— PASS: TestThirdTry (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch2/test">cs.liangjiajia.com/ch2/test</a>     1.492s</p>
</blockquote>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>4⃣</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>fourth_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> try_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Sunday = <span class="literal">iota</span></span><br><span class="line">	Monday</span><br><span class="line">	Tuesday</span><br><span class="line">	Wednesday</span><br><span class="line">	Thursday</span><br><span class="line">	Friday</span><br><span class="line">	Saturday</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFourth</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	t.Log(Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestFourth<br>
h:\go_learning\src\ch2\test\fourth_test.go:16: 0 1 2 3 4 5 6<br>
— PASS: TestFourth (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch2/test">cs.liangjiajia.com/ch2/test</a>     1.474s</p>
</blockquote>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>5⃣</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0035-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>​fifth_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> try_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Readable = <span class="number">1</span> &lt;&lt; <span class="literal">iota</span></span><br><span class="line">	Writable</span><br><span class="line">	Executable</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFifth</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	t.Log(Readable, Writable, Executable)</span><br><span class="line">	flag1 := <span class="number">7</span> <span class="comment">// 0111</span></span><br><span class="line">	flag2 := <span class="number">3</span> <span class="comment">// 0011</span></span><br><span class="line">	t.Log(flag1&amp;Readable == Readable, flag1&amp;Writable == Writable, flag1&amp;Executable == Executable)</span><br><span class="line">	t.Log(flag2&amp;Readable == Readable, flag2&amp;Writable == Writable, flag2&amp;Executable == Executable)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>Readable</code>：1 &lt;&lt; 0，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0001</mn></mrow><annotation encoding="application/x-tex">0001</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span></span></span></span></li>
<li><code>Writable</code>：1 &lt;&lt; 1，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0010</mn></mrow><annotation encoding="application/x-tex">0010</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">0</span></span></span></span></li>
<li><code>Executable</code>：1 &lt;&lt; 2，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0100</mn></mrow><annotation encoding="application/x-tex">0100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span></li>
</ul>
<blockquote>
<p>=== RUN   TestFifth<br>
h:\go_learning\src\ch2\test\fifth_test.go:12: 1 2 4<br>
h:\go_learning\src\ch2\test\fifth_test.go:15: true true true<br>
h:\go_learning\src\ch2\test\fifth_test.go:16: true true false<br>
— PASS: TestFifth (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch2/test">cs.liangjiajia.com/ch2/test</a>     1.418s</p>
</blockquote>
<h3 id="基本数据类型">基本数据类型</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch3\type</i></p>
<ul>
<li>
<p><b>布尔型</b>：<code>bool</code></p>
</li>
<li>
<p><b>字符串类型</b>：<code>string</code></p>
</li>
<li>
<p><b>数字类型</b>：</p>
<ul>
<li>
<p><code>int</code>（32位或64位）、<code>int8</code>、<code>int16</code>、<code>int32</code>、<code>int64</code></p>
</li>
<li>
<p><code>uint</code>（32位或64位）、<code>uint8</code>、<code>uint16</code>、<code>uint32</code>、<code>uint64</code>、<code>unitptr</code>（无符号整型，用于存放一个指针）</p>
</li>
</ul>
</li>
<li>
<p><b>浮点型</b>：</p>
<ul>
<li><code>float32</code>、<code>float64</code></li>
<li><code>complex64</code>、<code>complex128</code></li>
</ul>
</li>
<li>
<p><code>byte</code>：类似<code>unit8</code></p>
</li>
<li>
<p><code>rune</code>：类似<code>int32</code></p>
</li>
</ul>
<p><font color="red"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Go</mtext></mrow><annotation encoding="application/x-tex">\text {Go}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Go</span></span></span></span></span> 语言不支持隐式类型转换</font></p>
<p><code>type_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestImplicit</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> a <span class="type">int32</span> = <span class="number">1</span></span><br><span class="line">	<span class="keyword">var</span> b <span class="type">int64</span></span><br><span class="line">	b = <span class="type">int64</span>(a)</span><br><span class="line">	t.Log(a, b)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestImplicit<br>
h:\go_learning\src\ch3\type\type_test.go:11: 1 1<br>
— PASS: TestImplicit (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch3/type">cs.liangjiajia.com/ch3/type</a>     1.431s</p>
</blockquote>
<p>不支持指针运算，<code>string</code>类型初始化为空字符串。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestPoint</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	a := <span class="number">1</span></span><br><span class="line">	aPtr := &amp;a</span><br><span class="line">	t.Logf(<span class="string">"%T %T"</span>, a, aPtr)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestPoint<br>
h:\go_learning\src\ch3\type\type_test.go:17: int *int<br>
— PASS: TestPoint (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch3/type">cs.liangjiajia.com/ch3/type</a>     1.504s</p>
</blockquote>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestString</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> s <span class="type">string</span></span><br><span class="line">	t.Log(<span class="string">"*"</span> + s + <span class="string">"*"</span>)</span><br><span class="line">	t.Log(<span class="built_in">len</span>(s))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestString<br>
h:\go_learning\src\ch3\type\type_test.go:22: **<br>
h:\go_learning\src\ch3\type\type_test.go:23: 0<br>
— PASS: TestString (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch3/type">cs.liangjiajia.com/ch3/type</a>     1.600s</p>
</blockquote>
<h3 id="运算符">运算符</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch4\operator</i></p>
<h4 id="算术运算符">算术运算符</h4>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>+</code></td>
<td>相加</td>
</tr>
<tr>
<td><code>-</code></td>
<td>相减</td>
</tr>
<tr>
<td><code>*</code></td>
<td>相乘</td>
</tr>
<tr>
<td><code>/</code></td>
<td>相除</td>
</tr>
<tr>
<td><code>%</code></td>
<td>求余</td>
</tr>
<tr>
<td><code>++</code></td>
<td>自增</td>
</tr>
<tr>
<td><code>--</code></td>
<td>自减</td>
</tr>
</tbody>
</table>
<h4 id="比较运算符">比较运算符</h4>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>==</code></td>
<td>检查两个值是否相等</td>
</tr>
<tr>
<td><code>!=</code></td>
<td>检查两个值是否不相等</td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td>检查左边值是否大于右边值</td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>检查左边值是否小于右边值</td>
</tr>
<tr>
<td><code>&gt;=</code></td>
<td>检查左边值是否大于等于右边值</td>
</tr>
<tr>
<td><code>&lt;=</code></td>
<td>检查左边值是否小于等于右边值</td>
</tr>
</tbody>
</table>
<blockquote>
<p>用<code>==</code>比较数组，维度相同，对应元素相同</p>
</blockquote>
<p><code>operator_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCompareArray</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	a := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>}</span><br><span class="line">	b := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>}</span><br><span class="line">	c := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>}</span><br><span class="line">	<span class="comment">// d := [...]int{1, 2, 3, 4, 5}</span></span><br><span class="line">	t.Log(a == b)</span><br><span class="line">	t.Log(a == c)</span><br><span class="line">	<span class="comment">// t.Log(a == d) // invalid operation: a == d (mismatched types [4]int and [5]int)</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestCompareArray<br>
h:\go_learning\src\ch4\operator\operator_test.go:10: false<br>
h:\go_learning\src\ch4\operator\operator_test.go:11: true<br>
— PASS: TestCompareArray (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch4/operator">cs.liangjiajia.com/ch4/operator</a> 1.485s</p>
</blockquote>
<h4 id="逻辑运算符">逻辑运算符</h4>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&amp;&amp;</code></td>
<td>逻辑 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>AND</mtext></mrow><annotation encoding="application/x-tex">\text {AND}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">AND</span></span></span></span></span> 运算符</td>
</tr>
<tr>
<td><code>||</code></td>
<td>逻辑 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>OR</mtext></mrow><annotation encoding="application/x-tex">\text {OR}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">OR</span></span></span></span></span> 运算符</td>
</tr>
<tr>
<td><code>!</code></td>
<td>逻辑 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>NOT</mtext></mrow><annotation encoding="application/x-tex">\text {NOT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">NOT</span></span></span></span></span> 运算符</td>
</tr>
</tbody>
</table>
<h4 id="位运算符">位运算符</h4>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&amp;</code></td>
<td>按位与运算符</td>
</tr>
<tr>
<td><code>|</code></td>
<td>按位或运算符</td>
</tr>
<tr>
<td><code>^</code></td>
<td>按位异或运算符</td>
</tr>
<tr>
<td><code>&lt;&lt;</code></td>
<td>左移运算符</td>
</tr>
<tr>
<td><code>&gt;&gt;</code></td>
<td>右移运算符</td>
</tr>
</tbody>
</table>
<p><code>&amp;^</code>：按位置零</p>
<ul>
<li><code>1 &amp;^ 0</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">→</span></span></span></span> <code>1</code></li>
<li><code>0 &amp;^ 0</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">→</span></span></span></span> <code>0</code></li>
<li><code>1 &amp;^ 1</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">→</span></span></span></span> <code>0</code></li>
<li><code>0 &amp;^ 1</code> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">→</span></span></span></span> <code>0</code></li>
</ul>
<p><code>operator_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Readable = <span class="number">1</span> &lt;&lt; <span class="literal">iota</span></span><br><span class="line">	Writable</span><br><span class="line">	Executable</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestBitClear</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	t.Log(Readable, Writable, Executable)</span><br><span class="line">	flag := <span class="number">7</span> <span class="comment">// 0111</span></span><br><span class="line">	t.Log(flag&amp;Readable == Readable, flag&amp;Writable == Writable, flag&amp;Executable == Executable)</span><br><span class="line">	flag = flag &amp;^ Readable</span><br><span class="line">	t.Log(flag&amp;Readable == Readable, flag&amp;Writable == Writable, flag&amp;Executable == Executable)</span><br><span class="line">	flag = flag &amp;^ Executable</span><br><span class="line">	t.Log(flag&amp;Readable == Readable, flag&amp;Writable == Writable, flag&amp;Executable == Executable)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestBitClear<br>
h:\go_learning\src\ch4\operator\operator_test.go:22: 1 2 4<br>
h:\go_learning\src\ch4\operator\operator_test.go:24: true true true<br>
h:\go_learning\src\ch4\operator\operator_test.go:26: false true true<br>
h:\go_learning\src\ch4\operator\operator_test.go:28: false true false<br>
— PASS: TestBitClear (0.00s)<br>
PASS<br>
ok</p>
</blockquote>
<h3 id="条件语句">条件语句</h3>
<p><code>if</code>条件语句：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition { </span><br><span class="line">    <span class="comment">/* Execute when the boolean condition is true */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>if...else...</code>条件语句：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition {</span><br><span class="line">    <span class="comment">/* Execute when the boolean condition is true */</span></span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">/* Execute when the boolean condition is false */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>switch</code>条件语句：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> condition {</span><br><span class="line">    <span class="keyword">case</span> value1,...:</span><br><span class="line">        <span class="comment">/* Execute when condition equals value1,.. */</span></span><br><span class="line">    <span class="keyword">case</span> value2,...:</span><br><span class="line">        <span class="comment">/* Execute when condition equals value2,... */</span></span><br><span class="line">    <span class="keyword">case</span> value3,...:</span><br><span class="line">        <span class="comment">/* Execute when condition equals value3,... */</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">/* Execute when none of the above cases match */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>select</code>条件语句：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> dataFromChannel1 := &lt;-channel1:</span><br><span class="line">        <span class="comment">/* Execute when data is received from channel1 */</span></span><br><span class="line">    <span class="keyword">case</span> dataFromChannel2 := &lt;-channel2:</span><br><span class="line">        <span class="comment">/* Execute when data is received from channel2 */</span></span><br><span class="line">    <span class="keyword">case</span> channel1 &lt;- newData:</span><br><span class="line">        <span class="comment">/* Execute when newData is sent to channel1 */</span></span><br><span class="line">    <span class="keyword">case</span> channel2 &lt;- newData:</span><br><span class="line">        <span class="comment">/* Execute when newData is sent to channel2 */</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">/* Execute when no channel operation is ready */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch5\condition&lt;/i&gt;</i></p><i>
<p><code>condition_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestIfCondition</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ {</span><br><span class="line">		<span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">0</span> {</span><br><span class="line">			t.Log(<span class="string">"Even"</span>)</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			t.Log(<span class="string">"Odd"</span>)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestIfCondition<br>
h:\go_learning\src\ch5\condition\condition_test.go:9: Even<br>
h:\go_learning\src\ch5\condition\condition_test.go:11: Odd<br>
h:\go_learning\src\ch5\condition\condition_test.go:9: Even<br>
h:\go_learning\src\ch5\condition\condition_test.go:11: Odd<br>
h:\go_learning\src\ch5\condition\condition_test.go:9: Even<br>
— PASS: TestIfCondition (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch5/condition">cs.liangjiajia.com/ch5/condition</a>        (cached)</p>
</blockquote>
<p><code>condition_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if-else</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestIfElseCondition</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ {</span><br><span class="line">		<span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">0</span> {</span><br><span class="line">			t.Log(<span class="string">"Even"</span>)</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">1</span> {</span><br><span class="line">			t.Log(<span class="string">"Odd"</span>)</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> i%<span class="number">2</span> != <span class="number">1</span> &amp;&amp; i%<span class="number">2</span> != <span class="number">0</span> {</span><br><span class="line">			t.Log(<span class="string">"Unkonw"</span>)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestIfElseCondition<br>
h:\go_learning\src\ch5\condition\condition_test.go:20: Even<br>
h:\go_learning\src\ch5\condition\condition_test.go:23: Odd<br>
h:\go_learning\src\ch5\condition\condition_test.go:20: Even<br>
h:\go_learning\src\ch5\condition\condition_test.go:23: Odd<br>
h:\go_learning\src\ch5\condition\condition_test.go:20: Even<br>
— PASS: TestIfElseCondition (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch5/condition">cs.liangjiajia.com/ch5/condition</a>        (cached)</p>
</blockquote>
<p><code>condition_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSwitchCaseCondition</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ {</span><br><span class="line">		<span class="keyword">switch</span> {</span><br><span class="line">		<span class="keyword">case</span> i%<span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">			t.Log(<span class="string">"Even"</span>)</span><br><span class="line">		<span class="keyword">case</span> i%<span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">			t.Log(<span class="string">"Odd"</span>)</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			t.Log(<span class="string">"Unkonw"</span>)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSwitchCaseCondition<br>
h:\go_learning\src\ch5\condition\condition_test.go:36: Even<br>
h:\go_learning\src\ch5\condition\condition_test.go:38: Odd<br>
h:\go_learning\src\ch5\condition\condition_test.go:36: Even<br>
h:\go_learning\src\ch5\condition\condition_test.go:38: Odd<br>
h:\go_learning\src\ch5\condition\condition_test.go:36: Even<br>
— PASS: TestSwitchCaseCondition (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch5/condition">cs.liangjiajia.com/ch5/condition</a>        0.038s</p>
</blockquote>
<p><code>condition_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSwitchMultiCaseCondition</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ {</span><br><span class="line">		<span class="keyword">switch</span> i {</span><br><span class="line">		<span class="keyword">case</span> <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>:</span><br><span class="line">			t.Log(<span class="string">"Even"</span>)</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>, <span class="number">3</span>:</span><br><span class="line">			t.Log(<span class="string">"Odd"</span>)</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			t.Log(<span class="string">"Unkonw"</span>)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSwitchMultiCaseCondition<br>
h:\go_learning\src\ch5\condition\condition_test.go:49: Even<br>
h:\go_learning\src\ch5\condition\condition_test.go:51: Odd<br>
h:\go_learning\src\ch5\condition\condition_test.go:49: Even<br>
h:\go_learning\src\ch5\condition\condition_test.go:51: Odd<br>
h:\go_learning\src\ch5\condition\condition_test.go:49: Even<br>
— PASS: TestSwitchMultiCaseCondition (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch5/condition">cs.liangjiajia.com/ch5/condition</a>        0.039s</p>
</blockquote>
<h3 id="循环语句">循环语句</h3>
<p><code>for</code>循环</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> init; condition; post {</span><br><span class="line">    <span class="comment">/* Execute the loop body while the condition is true */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>类<code>while</code>循环</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> condition { </span><br><span class="line">    <span class="comment">/* Execute the loop body while the condition is true */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>init</code>： 一般为赋值表达式，给控制变量赋初值；</li>
<li><code>condition</code>： 关系表达式或逻辑表达式，循环控制条件；</li>
<li><code>post</code>： 一般为赋值表达式，给控制变量增量或减量。</li>
</ul>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch5\loop</i></p>
<p><code>loop_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestWhileLoop</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	i := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i &lt; <span class="number">5</span> {</span><br><span class="line">		t.Log(i)</span><br><span class="line">		i++</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestWhileLoop<br>
h:\go_learning\src\ch5\loop\loop_test.go:8: 0<br>
h:\go_learning\src\ch5\loop\loop_test.go:8: 1<br>
h:\go_learning\src\ch5\loop\loop_test.go:8: 2<br>
h:\go_learning\src\ch5\loop\loop_test.go:8: 3<br>
h:\go_learning\src\ch5\loop\loop_test.go:8: 4<br>
— PASS: TestWhileLoop (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch5/loop">cs.liangjiajia.com/ch5/loop</a>     1.522s</p>
</blockquote>
<p><code>loop_test.go</code>：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func TestForLoop(t *testing.T) {</span><br><span class="line">	for i := 0; i &lt; 5; i++ {</span><br><span class="line">		t.Log(i)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestForLoop<br>
h:\go_learning\src\ch5\loop\loop_test.go:15: 0<br>
h:\go_learning\src\ch5\loop\loop_test.go:15: 1<br>
h:\go_learning\src\ch5\loop\loop_test.go:15: 2<br>
h:\go_learning\src\ch5\loop\loop_test.go:15: 3<br>
h:\go_learning\src\ch5\loop\loop_test.go:15: 4<br>
— PASS: TestForLoop (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch5/loop">cs.liangjiajia.com/ch5/loop</a>     0.039s</p>
</blockquote>
<h2 id="常用集合">常用集合</h2>
<h3 id="数组">数组</h3>
<h4 id="数组声明">数组声明</h4>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arrayName [size]dataType</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组声明</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestArrayDeclare</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> arr [<span class="number">3</span>]<span class="type">int</span></span><br><span class="line">	t.Log(arr)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestArrayDeclare<br>
h:\go_learning\src\ch6\array\array_test.go:8: [0 0 0]<br>
— PASS: TestArrayDeclare (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/array">cs.liangjiajia.com/ch6/array</a>    1.567s</p>
</blockquote>
<h4 id="数组初始化">数组初始化</h4>
<ul>
<li>指定数组长度</li>
</ul>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arrayName [size]dataType{element_1,element_2,...,element_size<span class="number">-1</span>}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrayName := [size]dataType{element_1,element_2,...,element_size<span class="number">-1</span>}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>不指定数组长度，自动推断</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var arrayName [...]dataType{element_1,element_2,...}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrayName := [...]dataType{element_1,element_2,...}</span><br></pre></td></tr></tbody></table></figure>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch6\array</i></p>
<p><code>array_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组初始化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestArrayInit</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	arr1 := [<span class="number">3</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>} <span class="comment">// var arr1 = [3]int{1, 2, 3}</span></span><br><span class="line">	t.Log(arr1)</span><br><span class="line"></span><br><span class="line">	arr2 := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>} <span class="comment">// var arr2 =[...]int{1,2,3}</span></span><br><span class="line">	t.Log(arr2)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestArrayInit<br>
h:\go_learning\src\ch6\array\array_test.go:14: [1 2 3]<br>
h:\go_learning\src\ch6\array\array_test.go:17: [1 2 3]<br>
— PASS: TestArrayInit (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/array">cs.liangjiajia.com/ch6/array</a>    0.040s</p>
</blockquote>
<h4 id="关于数组遍历-数组切片-数组扩容">关于数组遍历，数组切片，数组扩容</h4>
<p><code>array_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组遍历</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestArrayTravel</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	arr := [<span class="number">3</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(arr); i++ {</span><br><span class="line">		t.Log(arr[i])</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> _, e := <span class="keyword">range</span> arr {</span><br><span class="line">		t.Log(e)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestArrayTravel<br>
h:\go_learning\src\ch6\array\array_test.go:24: 1<br>
h:\go_learning\src\ch6\array\array_test.go:24: 2<br>
h:\go_learning\src\ch6\array\array_test.go:24: 3<br>
h:\go_learning\src\ch6\array\array_test.go:27: 1<br>
h:\go_learning\src\ch6\array\array_test.go:27: 2<br>
h:\go_learning\src\ch6\array\array_test.go:27: 3<br>
— PASS: TestArrayTravel (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/array">cs.liangjiajia.com/ch6/array</a>    0.039s</p>
</blockquote>
<p><code>array_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组切片</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestArraySection</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	arr := [<span class="number">5</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>}</span><br><span class="line">	arr_sec1 := arr[:<span class="number">2</span>]</span><br><span class="line">	arr_sec2 := arr[<span class="number">3</span>:]</span><br><span class="line">	t.Log(arr_sec1, arr_sec2)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestArraySection<br>
h:\go_learning\src\ch6\array\array_test.go:36: [1 2] [4 5]<br>
— PASS: TestArraySection (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/array">cs.liangjiajia.com/ch6/array</a>    0.038s</p>
</blockquote>
<p><code>array_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组扩容</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestArraySliceGrowing</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	arr := []<span class="type">int</span>{}</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">		arr = <span class="built_in">append</span>(arr, i)</span><br><span class="line">		t.Log(<span class="built_in">len</span>(arr), <span class="built_in">cap</span>(arr))</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestArraySliceGrowing<br>
h:\go_learning\src\ch6\array\array_test.go:44: 1 1<br>
h:\go_learning\src\ch6\array\array_test.go:44: 2 2<br>
h:\go_learning\src\ch6\array\array_test.go:44: 3 4<br>
h:\go_learning\src\ch6\array\array_test.go:44: 4 4<br>
h:\go_learning\src\ch6\array\array_test.go:44: 5 8<br>
h:\go_learning\src\ch6\array\array_test.go:44: 6 8<br>
h:\go_learning\src\ch6\array\array_test.go:44: 7 8<br>
h:\go_learning\src\ch6\array\array_test.go:44: 8 8<br>
h:\go_learning\src\ch6\array\array_test.go:44: 9 16<br>
h:\go_learning\src\ch6\array\array_test.go:44: 10 16<br>
— PASS: TestArraySliceGrowing (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/array">cs.liangjiajia.com/ch6/array</a>    0.040s</p>
</blockquote>
<p><code>array_test.go</code>：<font color="red">数组切片共享原数组的存储空间</font></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组切片共享内存空间</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSliceShareMemory</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	year := []<span class="type">string</span>{<span class="string">"Jan"</span>, <span class="string">"Feb"</span>, <span class="string">"Mar"</span>, <span class="string">"Apr"</span>, <span class="string">"May"</span>, <span class="string">"Jun"</span>, <span class="string">"Jul"</span>, <span class="string">"Aug"</span>, <span class="string">"Sep"</span>, <span class="string">"Oct"</span>, <span class="string">"Nov"</span>, <span class="string">"Dec"</span>}</span><br><span class="line">	summer := year[<span class="number">5</span>:<span class="number">8</span>]</span><br><span class="line">	t.Log(summer, <span class="built_in">len</span>(summer), <span class="built_in">cap</span>(summer))</span><br><span class="line">	summer[<span class="number">0</span>] = <span class="string">"Unknow"</span></span><br><span class="line">	t.Log(year)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSliceShareMemory<br>
h:\go_learning\src\ch6\array\array_test.go:52: [Jun Jul Aug] 3 7<br>
h:\go_learning\src\ch6\array\array_test.go:54: [Jan Feb Mar Apr May Unknow Jul Aug Sep Oct Nov Dec]<br>
— PASS: TestSliceShareMemory (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/array">cs.liangjiajia.com/ch6/array</a>    1.499s</p>
</blockquote>
<h3 id="map">Map</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch6\map</i></p>
<p><code>map_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map初始化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMapInit</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	m1 := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>{</span><br><span class="line">		<span class="string">"apple"</span>:  <span class="number">1</span>,</span><br><span class="line">		<span class="string">"banana"</span>: <span class="number">2</span>,</span><br><span class="line">		<span class="string">"orange"</span>: <span class="number">3</span>,</span><br><span class="line">	}</span><br><span class="line">	t.Log(m1)</span><br><span class="line"></span><br><span class="line">	m2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">	m2[<span class="string">"red"</span>] = <span class="number">1</span></span><br><span class="line">	m2[<span class="string">"yellow"</span>] = <span class="number">2</span></span><br><span class="line">	m2[<span class="string">"orange"</span>] = <span class="number">3</span></span><br><span class="line">	t.Log(m2)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestMapInit<br>
h:\go_learning\src\ch6\map\map_test.go:11: map[apple:1 banana:2 orange:3]<br>
h:\go_learning\src\ch6\map\map_test.go:17: map[orange:3 red:1 yellow:2]<br>
— PASS: TestMapInit (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/map">cs.liangjiajia.com/ch6/map</a>      1.487s</p>
</blockquote>
<h4 id="键不存在">键不存在</h4>
<p><code>map_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map：Key不存在 Value 被初始化为零值，区分 Value 本身是零值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAccessNotExistingKey</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>{</span><br><span class="line">		<span class="string">"one"</span>:   <span class="number">1</span>,</span><br><span class="line">		<span class="string">"two"</span>:   <span class="number">2</span>,</span><br><span class="line">		<span class="string">"three"</span>: <span class="number">3</span>,</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> v, ok := m[<span class="string">"four"</span>]; ok {</span><br><span class="line">		t.Log(<span class="string">"four"</span>, v)</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		t.Log(<span class="string">"Not existing!"</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestAccessNotExistingKey<br>
h:\go_learning\src\ch6\map\map_test.go:29: Not existing!<br>
— PASS: TestAccessNotExistingKey (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/map">cs.liangjiajia.com/ch6/map</a>      0.036s</p>
</blockquote>
<h4 id="map遍历">Map遍历</h4>
<p><code>map_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map遍历</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMapTravel</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>{</span><br><span class="line">		<span class="string">"one"</span>:   <span class="number">1</span>,</span><br><span class="line">		<span class="string">"two"</span>:   <span class="number">2</span>,</span><br><span class="line">		<span class="string">"three"</span>: <span class="number">3</span>,</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> m {</span><br><span class="line">		t.Log(k, v)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestMapTravel<br>
h:\go_learning\src\ch6\map\map_test.go:40: one 1<br>
h:\go_learning\src\ch6\map\map_test.go:40: two 2<br>
h:\go_learning\src\ch6\map\map_test.go:40: three 3<br>
— PASS: TestMapTravel (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/map">cs.liangjiajia.com/ch6/map</a>      0.040s</p>
</blockquote>
<h4 id="map增删改查">Map增删改查</h4>
<p><code>map_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map增删改查</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMapOperation</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>{</span><br><span class="line">		<span class="string">"one"</span>:   <span class="number">1</span>,</span><br><span class="line">		<span class="string">"two"</span>:   <span class="number">2</span>,</span><br><span class="line">		<span class="string">"three"</span>: <span class="number">3</span>,</span><br><span class="line">	}</span><br><span class="line">	m[<span class="string">"four"</span>] = <span class="number">5</span> <span class="comment">// add</span></span><br><span class="line">	t.Log(m, <span class="built_in">len</span>(m))</span><br><span class="line"></span><br><span class="line">	m[<span class="string">"four"</span>] = <span class="number">4</span> <span class="comment">// update</span></span><br><span class="line">	t.Log(m, <span class="built_in">len</span>(m))</span><br><span class="line"></span><br><span class="line">	t.Log(m[<span class="string">"four"</span>]) <span class="comment">// select</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">delete</span>(m, <span class="string">"four"</span>) <span class="comment">//delete</span></span><br><span class="line">	t.Log(m, <span class="built_in">len</span>(m))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestMapOperation<br>
h:\go_learning\src\ch6\map\map_test.go:55: map[four:5 one:1 three:3 two:2] 4<br>
h:\go_learning\src\ch6\map\map_test.go:58: map[four:4 one:1 three:3 two:2] 4<br>
h:\go_learning\src\ch6\map\map_test.go:60: 4<br>
h:\go_learning\src\ch6\map\map_test.go:63: map[one:1 three:3 two:2] 3<br>
— PASS: TestMapOperation (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch6/map">cs.liangjiajia.com/ch6/map</a>      1.517s</p>
</blockquote>
<h2 id="字符串">字符串</h2>
<p>在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Go</mtext></mrow><annotation encoding="application/x-tex">\text {Go}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Go</span></span></span></span></span> 语言中，字符串的长度（<code>len</code>函数返回的值）是按字节数来计算的，而不是按字符数。这意味着一个字符串的长度表示的是它包含的字节数，而不是字符数。所以，不同字符的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>UTF-8</mtext></mrow><annotation encoding="application/x-tex">\text {UTF-8}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">UTF-8</span></span></span></span></span> 编码占用的字节数不同，因此导致字符串的长度不同。</p>
<ul>
<li>一个英文字符等于一个字节</li>
<li>一个中文（含繁体）等于三个字节</li>
<li>一个中文标点占三个字节</li>
<li>一个英文标点占一个字节</li>
</ul>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch7\string</i></p>
<p><code>string_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串对应字节数组长度</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStringLen</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	s := <span class="string">"hello"</span></span><br><span class="line">	t.Log(s, <span class="built_in">len</span>(s))</span><br><span class="line">	s = <span class="string">"中"</span></span><br><span class="line">	t.Log(s, <span class="built_in">len</span>(s))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestString<br>
h:\go_learning\src\ch7\string\string_test.go:7: hello 5<br>
h:\go_learning\src\ch7\string\string_test.go:9: 中 3<br>
— PASS: TestString (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch7/string">cs.liangjiajia.com/ch7/string</a>   1.609s</p>
</blockquote>
<p>可以将字符串转换为<code>rune</code>切片，每个<code>rune</code>元素表示一个字符的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Unicode</mtext></mrow><annotation encoding="application/x-tex">\text {Unicode}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Unicode</span></span></span></span></span> 码点，这允许处理和操作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Unicode</mtext></mrow><annotation encoding="application/x-tex">\text{Unicode}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Unicode</span></span></span></span></span> 字符。</p>
<p><code>string_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串长度</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStringToRune</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	s := <span class="string">"\xe4\xba\xba\xe6\xb0\x91\xe4\xb8\x87\xe5\xb2\x81"</span></span><br><span class="line">	t.Log(s, <span class="built_in">len</span>(s))</span><br><span class="line">	c := []<span class="type">rune</span>(s) <span class="comment">// \u4EBA\u6C11\u4E07\u5C81 &lt;-&gt; 20154 27665 19975 23681</span></span><br><span class="line">	t.Log(c, <span class="built_in">len</span>(c))</span><br><span class="line">	<span class="keyword">for</span> _, c := <span class="keyword">range</span> s {</span><br><span class="line">		t.Logf(<span class="string">"%[1]c %[1]x"</span>, c)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestStringToRune<br>
h:\go_learning\src\ch7\string\string_test.go:14: 人民万岁 12<br>
h:\go_learning\src\ch7\string\string_test.go:16: [20154 27665 19975 23681] 4<br>
h:\go_learning\src\ch7\string\string_test.go:18: 人 4eba<br>
h:\go_learning\src\ch7\string\string_test.go:18: 民 6c11<br>
h:\go_learning\src\ch7\string\string_test.go:18: 万 4e07<br>
h:\go_learning\src\ch7\string\string_test.go:18: 岁 5c81<br>
— PASS: TestStringToRune (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch7/string">cs.liangjiajia.com/ch7/string</a>   (cached)</p>
</blockquote>
<p><code>string_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串相关函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStringFn</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	s := <span class="string">"A,B,C"</span></span><br><span class="line">	parts := strings.Split(s, <span class="string">","</span>)</span><br><span class="line">	<span class="keyword">for</span> _, part := <span class="keyword">range</span> parts {</span><br><span class="line">		t.Log(part)</span><br><span class="line">	}</span><br><span class="line">	t.Log(strings.Join(parts, <span class="string">"-"</span>))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestStringFn<br>
h:\go_learning\src\ch7\string\string_test.go:33: A<br>
h:\go_learning\src\ch7\string\string_test.go:33: B<br>
h:\go_learning\src\ch7\string\string_test.go:33: C<br>
h:\go_learning\src\ch7\string\string_test.go:35: A-B-C<br>
— PASS: TestStringFn (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch7/string">cs.liangjiajia.com/ch7/string</a>   1.493s</p>
</blockquote>
<p><code>string_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// String与数字相互转换</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStringConvDigital</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	s := strconv.Itoa(<span class="number">10</span>) <span class="comment">// digital:10 --&gt; string:10</span></span><br><span class="line">	t.Log(<span class="string">"10"</span> + s)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> i, err := strconv.Atoi(<span class="string">"10"</span>); err == <span class="literal">nil</span> { <span class="comment">// string:10 --&gt; digital:10</span></span><br><span class="line">		t.Log(<span class="number">10</span> + i)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestStringConvDigital<br>
h:\go_learning\src\ch7\string\string_test.go:41: 1010<br>
h:\go_learning\src\ch7\string\string_test.go:44: 20<br>
— PASS: TestStringConvDigital (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch7/string">cs.liangjiajia.com/ch7/string</a>   0.040s</p>
</blockquote>
<h2 id="函数">函数</h2>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch8\function</i></p>
<p><code>function_test.go</code>：计算一个函数所花的时间（使用函数作为参数和返回值）。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">timeSpent</span><span class="params">(inner <span class="keyword">func</span>()</span></span>) <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		start := time.Now()</span><br><span class="line">		inner()</span><br><span class="line">		fmt.Println(<span class="string">"time spent:"</span>, time.Since(start).Seconds())</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">slowFun</span><span class="params">()</span></span> {</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFunction</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	tsSF := timeSpent(slowFun)</span><br><span class="line">	tsSF()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestFunction<br>
time spent: 1.0077673<br>
— PASS: TestFunction (1.01s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch8/function">cs.liangjiajia.com/ch8/function</a> 6.640s</p>
</blockquote>
<p><code>function_test.go</code>：计算任意多个值得和（函数可变参数）。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum</span><span class="params">(ops ...<span class="type">int</span>)</span></span> <span class="type">int</span> {</span><br><span class="line">	ret := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, op := <span class="keyword">range</span> ops {</span><br><span class="line">		ret += op</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFunctionVarParam</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	t.Log(Sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">	t.Log(Sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestFunctionVarParam<br>
h:\go_learning\src\ch8\function\function_test.go:35: 10<br>
h:\go_learning\src\ch8\function\function_test.go:36: 15<br>
— PASS: TestFunctionVarParam (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch8/function">cs.liangjiajia.com/ch8/function</a> 5.636s</p>
</blockquote>
<p><code>function_test.go</code>：抛出异常，释放资源（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>defer</mtext></mrow><annotation encoding="application/x-tex">\text {defer}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">defer</span></span></span></span></span> 函数）。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFunctionDefer</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		t.Log(<span class="string">"Clear resources"</span>)</span><br><span class="line">	}()</span><br><span class="line">	t.Log(<span class="string">"Started"</span>)</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">"Fatal error"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestFunctionDefer<br>
h:\go_learning\src\ch8\function\function_test.go:43: Started<br>
h:\go_learning\src\ch8\function\function_test.go:41: Clear resources<br>
— FAIL: TestFunctionDefer (0.00s)<br>
panic: Fatal error [recovered]<br>
panic: Fatal error</p>
</blockquote>
<h2 id="面向对象编程">面向对象编程</h2>
<h3 id="类和对象">类和对象</h3>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> struct_variable_type <span class="keyword">struct</span> {</span><br><span class="line">   member definition</span><br><span class="line">   member definition</span><br><span class="line">   ...</span><br><span class="line">   member definition</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch9\object</i></p>
<p><mark>属性定义</mark>：</p>
<p><code>encapsulation\encapsulation_test.go</code></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> {</span><br><span class="line">	Id   <span class="type">string</span></span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCreateEmployeeObj</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	e1 := Employee{<span class="string">"0"</span>, <span class="string">"Bob"</span>, <span class="number">20</span>}</span><br><span class="line">	t.Log(e1)</span><br><span class="line"></span><br><span class="line">	e2 := Employee{Name: <span class="string">"Mike"</span>, Age: <span class="number">30</span>}</span><br><span class="line">	t.Log(e2)</span><br><span class="line"></span><br><span class="line">	e3 := <span class="built_in">new</span>(Employee)</span><br><span class="line">	e3.Id = <span class="string">"2"</span></span><br><span class="line">	e3.Age = <span class="number">22</span></span><br><span class="line">	e3.Name = <span class="string">"Rose"</span></span><br><span class="line">	t.Log(e3)</span><br><span class="line"></span><br><span class="line">	t.Logf(<span class="string">"e1 is %T"</span>, e1)</span><br><span class="line">	t.Logf(<span class="string">"e2 is %T"</span>, e2)</span><br><span class="line">	t.Logf(<span class="string">"e3 is %T"</span>, e3)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestCreateEmployeeObj<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:17: {0 Bob 20}<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:20: { Mike 30}<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:26: &amp;{2 Rose 22}<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:28: e1 is encapsulation_test.Employee<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:29: e2 is encapsulation_test.Employee<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:30: e3 is *encapsulation_test.Employee<br>
— PASS: TestCreateEmployeeObj (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch9/object/encapsulation">cs.liangjiajia.com/ch9/object/encapsulation</a>     0.038s</p>
</blockquote>
<p><mark>行为定义</mark>：</p>
<p><code>encapsulation\encapsulation_test.go</code></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Employee)</span></span> String1() <span class="type">string</span> {</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"ID:%s/Name:%s/Age:%d"</span>, e.Id, e.Name, e.Age)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e Employee)</span></span> String2() <span class="type">string</span> {</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"ID:%s-Name:%s-Age:%d"</span>, e.Id, e.Name, e.Age)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStructOperations</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	e1 := Employee{<span class="string">"0"</span>, <span class="string">"Bob"</span>, <span class="number">20</span>}</span><br><span class="line">	t.Log(e1.String1())</span><br><span class="line">	t.Log(e1.String2())</span><br><span class="line"></span><br><span class="line">	e2 := &amp;Employee{<span class="string">"1"</span>, <span class="string">"Alice"</span>, <span class="number">20</span>}</span><br><span class="line">	t.Log(e2.String1())</span><br><span class="line">	t.Log(e2.String2())</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestStructOperations<br>
h:\go_learning\src\ch9\object\encap_test.go:42: ID:0/Name:Bob/Age:20<br>
h:\go_learning\src\ch9\object\encap_test.go:43: ID:0-Name:Bob-Age:20<br>
h:\go_learning\src\ch9\object\encap_test.go:46: ID:1/Name:Alice/Age:20<br>
h:\go_learning\src\ch9\object\encap_test.go:47: ID:1-Name:Alice-Age:20<br>
— PASS: TestStructOperations (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch9/object">cs.liangjiajia.com/ch9/object</a>   1.430s</p>
</blockquote>
<p>通过指针和实例来表述是一样的。</p>
<p><code>encapsulation\encapsulation_test.go</code>：通过地址打印查看区别</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Employee)</span></span> String1() <span class="type">string</span> {</span><br><span class="line">	fmt.Printf(<span class="string">"Address is %x\n"</span>, unsafe.Pointer(&amp;e.Name))</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"ID:%s/Name:%s/Age:%d"</span>, e.Id, e.Name, e.Age)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e Employee)</span></span> String2() <span class="type">string</span> {</span><br><span class="line">	fmt.Printf(<span class="string">"Address is %x\n"</span>, unsafe.Pointer(&amp;e.Name))</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"ID:%s-Name:%s-Age:%d"</span>, e.Id, e.Name, e.Age)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStructOperations</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	e1 := Employee{<span class="string">"0"</span>, <span class="string">"Bob"</span>, <span class="number">20</span>}</span><br><span class="line">	fmt.Printf(<span class="string">"Address is %x\n"</span>, unsafe.Pointer(&amp;e1.Name))</span><br><span class="line">	fmt.Println()</span><br><span class="line">	t.Log(e1.String1())</span><br><span class="line">	t.Log(e1.String2())</span><br><span class="line">    </span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">	e2 := &amp;Employee{<span class="string">"1"</span>, <span class="string">"Alice"</span>, <span class="number">20</span>}</span><br><span class="line">	fmt.Printf(<span class="string">"Address is %x\n"</span>, unsafe.Pointer(&amp;e2.Name))</span><br><span class="line">	fmt.Println()</span><br><span class="line">	t.Log(e2.String1())</span><br><span class="line">	t.Log(e2.String2())</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestStructOperations<br>
Address is c000074910</p>
<p>Address is c000074910<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:47: ID:0/Name:Bob/Age:20<br>
Address is c000074970<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:48: ID:0-Name:Bob-Age:20</p>
<p>Address is c0000749a0</p>
<p>Address is c0000749a0<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:55: ID:1/Name:Alice/Age:20<br>
Address is c0000749d0<br>
h:\go_learning\src\ch9\object\encapsulation\encapsulation_test.go:56: ID:1-Name:Alice-Age:20<br>
— PASS: TestStructOperations (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch9/object/encapsulation">cs.liangjiajia.com/ch9/object/encapsulation</a>     1.514s</p>
</blockquote>
<h3 id="接口">接口</h3>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> interface_name <span class="keyword">interface</span> {</span><br><span class="line">&nbsp; &nbsp;method_name1 [return_type]</span><br><span class="line">&nbsp; &nbsp;method_name2 [return_type]</span><br><span class="line">&nbsp; &nbsp;method_name3 [return_type]</span><br><span class="line">&nbsp; &nbsp;...</span><br><span class="line">&nbsp; &nbsp;method_namen [return_type]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> struct_name <span class="keyword">struct</span> {</span><br><span class="line">&nbsp; &nbsp;<span class="comment">/* variables */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(struct_name_variable struct_name)</span></span> method_name1() [return_type] {</span><br><span class="line">&nbsp; &nbsp;<span class="comment">// interface method_name1 implementation</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(struct_name_variable struct_name)</span></span> method_name2() [return_type] {</span><br><span class="line">&nbsp; &nbsp;<span class="comment">// interface method_name2 implementation</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(struct_name_variable struct_name)</span></span> method_namen() [return_type] {</span><br><span class="line">&nbsp; &nbsp;<span class="comment">// interface method_namen implementation</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch9\object</i></p>
<p><code>interface\interface_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Programmer <span class="keyword">interface</span> {</span><br><span class="line">	WriteHelloWorld() <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GoProgrammer <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(goProgrammer *GoProgrammer)</span></span> WriteHelloWorld() <span class="type">string</span> {</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"fmt.Println(\"Hello World\")"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestClient</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	p := <span class="built_in">new</span>(GoProgrammer)</span><br><span class="line">	t.Log(p.WriteHelloWorld())</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestClient<br>
h:\go_learning\src\ch9\object\interface\interface_test.go:18: fmt.Println(“Hello World”)<br>
— PASS: TestClient (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch9/object/interface">cs.liangjiajia.com/ch9/object/interface</a> 0.039s</p>
</blockquote>
<h3 id="空接口">空接口</h3>
<p><code>interface\empty_interface_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DoSomething</span><span class="params">(p <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">	<span class="comment">// if i, ok := p.(int); ok {</span></span><br><span class="line">	<span class="comment">// 	fmt.Println("Integer", i)</span></span><br><span class="line">	<span class="comment">// 	return</span></span><br><span class="line">	<span class="comment">// }</span></span><br><span class="line">	<span class="comment">// if s, ok := p.(string); ok {</span></span><br><span class="line">	<span class="comment">// 	fmt.Println("stirng", s)</span></span><br><span class="line">	<span class="comment">// 	return</span></span><br><span class="line">	<span class="comment">// }</span></span><br><span class="line">	<span class="comment">// fmt.Println("Unknow Type")</span></span><br><span class="line">	<span class="keyword">switch</span> v := p.(<span class="keyword">type</span>) {</span><br><span class="line">	<span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">		fmt.Println(<span class="string">"Integer"</span>, v)</span><br><span class="line">	<span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">		fmt.Println(<span class="string">"String"</span>, v)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">"Unknow Type"</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestEmptyInterfaceAssertion</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	DoSomething(<span class="number">10</span>)</span><br><span class="line">	DoSomething(<span class="string">"10"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestEmptyInterfaceAssertion<br>
Integer 10<br>
String 10<br>
— PASS: TestEmptyInterfaceAssertion (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch9/object/interface">cs.liangjiajia.com/ch9/object/interface</a> 1.447s</p>
</blockquote>
<h3 id="自定义类型">自定义类型</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch9\object</i></p>
<p><code>customer_type_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> object_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IntConv <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">timeSpent</span><span class="params">(inner IntConv)</span></span> IntConv {</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		start := time.Now()</span><br><span class="line">		inner()</span><br><span class="line">		fmt.Println(<span class="string">"time spent:"</span>, time.Since(start).Seconds())</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">slowFun</span><span class="params">()</span></span> {</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFunction</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	tsSF := timeSpent(slowFun)</span><br><span class="line">	tsSF()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestFunction<br>
time spent: 1.0059892<br>
— PASS: TestFunction (1.01s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch9/object">cs.liangjiajia.com/ch9/object</a>   (cached)</p>
</blockquote>
<h3 id="拓展复用">拓展复用</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch9\object</i></p>
<p><code>extension\extension_test.go</code>：宠物类</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Pet <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Pet)</span></span> Speak() {</span><br><span class="line">	fmt.Print(<span class="string">"..."</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Pet)</span></span> SpeakTo(host <span class="type">string</span>) {</span><br><span class="line">	p.Speak()</span><br><span class="line">	fmt.Println(<span class="string">" "</span>, host)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>extension\extension_test.go</code>：狗类</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> {</span><br><span class="line">	p *Pet</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Dog)</span></span> Speak() {</span><br><span class="line">	d.p.Speak()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Dog)</span></span> SpeakTo(host <span class="type">string</span>) {</span><br><span class="line">	d.p.SpeakTo(host)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>上述也可以简单表示：<code>extension\extension_test.go</code></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> {</span><br><span class="line">	Pet</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestDog</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	dog := <span class="built_in">new</span>(Dog)</span><br><span class="line">	dog.SpeakTo(<span class="string">"solisamicus"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestDog<br>
…  solisamicus<br>
— PASS: TestDog (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch9/object">cs.liangjiajia.com/ch9/object</a>   5.659s</p>
</blockquote>
<p>做部分修改：<code>extension\extension_test.go</code></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> {</span><br><span class="line">	p *Pet</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Dog)</span></span> Speak() {</span><br><span class="line">	fmt.Print(<span class="string">"Woof Woof Woof"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Dog)</span></span> SpeakTo(host <span class="type">string</span>) {</span><br><span class="line">	d.Speak()</span><br><span class="line">	fmt.Println(<span class="string">" "</span>, host)</span><br><span class="line">}<span class="keyword">go</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestDog<br>
Woof Woof Woof  solisamicus<br>
— PASS: TestDog (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch9/object/extension">cs.liangjiajia.com/ch9/object/extension</a>   5.801s</p>
</blockquote>
<h3 id="多态">多态</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch9\object</i></p>
<p><code>polymorphism\polymorphism_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Programmer <span class="keyword">interface</span> {</span><br><span class="line">	WriteHelloWorld() <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GoProgrammer <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> JavaProgrammer <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(goProgrammer *GoProgrammer)</span></span> WriteHelloWorld() <span class="type">string</span> {</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"fmt.Println(\"Hello World\")"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(javaProgrammer *JavaProgrammer)</span></span> WriteHelloWorld() <span class="type">string</span> {</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"System.out.Println(\"Hello World!\")"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeFirstProgram</span><span class="params">(prog Programmer)</span></span> {</span><br><span class="line">	fmt.Printf(<span class="string">"%T %v\n"</span>, prog, prog.WriteHelloWorld())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestClient</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	goProg := <span class="built_in">new</span>(GoProgrammer)</span><br><span class="line">	javaProg := &amp;JavaProgrammer{}</span><br><span class="line">	writeFirstProgram(goProg)</span><br><span class="line">	writeFirstProgram(javaProg)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestClient<br>
*polymorphism_test.GoProgrammer fmt.Println(“Hello World”)<br>
*polymorphism_test.JavaProgrammer System.out.Println(“Hello World!”)<br>
— PASS: TestClient (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch9/object/polymorphism">cs.liangjiajia.com/ch9/object/polymorphism</a>      1.522s</p>
</blockquote>
<h2 id="错误处理">错误处理</h2>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch10\error</i></p>
<p><code>error_test.go</code>：对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Fibonacci</mtext></mrow><annotation encoding="application/x-tex">\text {Fibonacci}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Fibonacci</span></span></span></span></span> 数列要求 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><mn>100</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">n \in [2,100]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">]</span></span></span></span></p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LessThanTwoError = errors.New(<span class="string">"n should be not less than 2"</span>)</span><br><span class="line"><span class="keyword">var</span> LargerThanHundredError = errors.New(<span class="string">"n should be not larger than 100"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetFibonacci</span><span class="params">(n <span class="type">int</span>)</span></span> ([]<span class="type">int</span>, <span class="type">error</span>) {</span><br><span class="line">	<span class="keyword">if</span> n &lt; <span class="number">2</span> {</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, LessThanTwoError</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> n &gt; <span class="number">100</span> {</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, LargerThanHundredError</span><br><span class="line">	}</span><br><span class="line">	fibList := []<span class="type">int</span>{<span class="number">1</span>, <span class="number">1</span>}</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">2</span>; i &lt; n; i++ {</span><br><span class="line">		fibList = <span class="built_in">append</span>(fibList, fibList[i<span class="number">-2</span>]+fibList[i<span class="number">-1</span>])</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> fibList, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetFibonacci</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">if</span> v, err := GetFibonacci(<span class="number">1</span>); err != <span class="literal">nil</span> {</span><br><span class="line">		t.Error(err)</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		t.Log(v)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestGetFibonacci<br>
h:\go_learning\src\ch10\error\error_test.go:29: n should be not less than 2<br>
— FAIL: TestGetFibonacci (0.00s)<br>
FAIL<br>
FAIL    <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch10/error">cs.liangjiajia.com/ch10/error</a>   2.071s</p>
</blockquote>
<p>其他两种改写方式：</p>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>1⃣</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>error_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetFibonacci1</span><span class="params">(str <span class="type">string</span>)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		i    <span class="type">int</span></span><br><span class="line">		err  <span class="type">error</span></span><br><span class="line">		list []<span class="type">int</span></span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> i, err = strconv.Atoi(str); err == <span class="literal">nil</span> {</span><br><span class="line">		<span class="keyword">if</span> list, err = GetFibonacci(i); err == <span class="literal">nil</span> {</span><br><span class="line">			fmt.Println(list)</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			fmt.Println(<span class="string">"Error"</span>, err)</span><br><span class="line">		}</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		fmt.Println(<span class="string">"Error"</span>, err)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetFibonacc1</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	GetFibonacci1(<span class="string">"1"</span>)</span><br><span class="line">	GetFibonacci1(<span class="string">"10"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestGetFibonacc1<br>
Error n should be not less than 2<br>
[1 1 2 3 5 8 13 21 34 55]<br>
— PASS: TestGetFibonacc1 (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch10/error">cs.liangjiajia.com/ch10/error</a>   0.045s</p>
</blockquote>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>2⃣</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>error_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetFibonacci2</span><span class="params">(str <span class="type">string</span>)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		i    <span class="type">int</span></span><br><span class="line">		err  <span class="type">error</span></span><br><span class="line">		list []<span class="type">int</span></span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> i, err = strconv.Atoi(str); err != <span class="literal">nil</span> {</span><br><span class="line">		fmt.Println(<span class="string">"Error"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> list, err = GetFibonacci(i); err != <span class="literal">nil</span> {</span><br><span class="line">		fmt.Println(<span class="string">"Error"</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	}</span><br><span class="line">	fmt.Println(list)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetFibonacc2</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	GetFibonacci2(<span class="string">"1"</span>)</span><br><span class="line">	GetFibonacci2(<span class="string">"10"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestGetFibonacc2<br>
Error n should be not less than 2<br>
[1 1 2 3 5 8 13 21 34 55]<br>
— PASS: TestGetFibonacc2 (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch10/error">cs.liangjiajia.com/ch10/error</a>   1.426s</p>
</blockquote>
<h2 id="包和依赖管理">包和依赖管理</h2>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Go</mtext></mrow><annotation encoding="application/x-tex">\text {Go}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Go</span></span></span></span></span> 语言中的标识符（变量、函数、类型等）的可见性是由首字母的大小写来决定的。</p>
<ul>
<li>大写字母开头的标识符是公开的，可以被其他包访问；</li>
<li>小写字母开头的标识符是私有的，只能在当前包内使用。</li>
</ul>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Go</mtext></mrow><annotation encoding="application/x-tex">\text {Go}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Go</span></span></span></span></span> 语言的编译和导入机制并不直接要求包名和目录名一致，但强烈建议保持它们一致，以提高代码的可读性和维护性。</p>
<p>同一目录的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Go</mtext></mrow><annotation encoding="application/x-tex">\text {Go}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Go</span></span></span></span></span> 的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>package</mtext></mrow><annotation encoding="application/x-tex">\text {package}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">package</span></span></span></span></span> 要保持一致。</p>
<blockquote>
<p>当建立工作空间目录后，需要把工作空间目录的路径添加的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>GOPATH</mtext></mrow><annotation encoding="application/x-tex">\text {GOPATH}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">GOPATH</span></span></span></span></span> 环境变量中。</p>
</blockquote>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch11\series</i></p>
<p><code>my_series.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> series</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetFibonacciSerie</span><span class="params">(n <span class="type">int</span>)</span></span> []<span class="type">int</span> {</span><br><span class="line">	ret := []<span class="type">int</span>{<span class="number">1</span>, <span class="number">1</span>}</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">2</span>; i &lt; n; i++ {</span><br><span class="line">		ret = <span class="built_in">append</span>(ret, ret[i<span class="number">-2</span>]+ret[i<span class="number">-1</span>])</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch11\client</i></p>
<p><code>package_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> client</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"cs.liangjiajia.com/ch11/series"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestPackage</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	t.Log(series.GetFibonacciSerie(<span class="number">5</span>))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestPackage<br>
h:\go_learning\src\ch11\client\package_test.go:10: [1 1 2 3 5]<br>
— PASS: TestPackage (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch11/client">cs.liangjiajia.com/ch11/client</a>  1.539s</p>
</blockquote>
<h3 id="使用第三方库">使用第三方库</h3>
<p><code>go get -u github.com/easierway/concurrent_map</code></p>
<div align="center">
&nbsp; <img src="../../../images/programming-language/go/1.png" style="zoom:50%;">
</div>
<span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch11\client</i>：
<p><code>remote_package_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> client</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line">	cm <span class="string">"github.com/easierway/concurrent_map"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestConcurrentMap</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	m := cm.CreateConcurrentMap(<span class="number">99</span>)</span><br><span class="line">	m.Set(cm.StrKey(<span class="string">"key"</span>), <span class="number">10</span>)</span><br><span class="line">	t.Log(m.Get(cm.StrKey(<span class="string">"key"</span>)))</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestConcurrentMap<br>
h:\go_learning\src\ch11\client\remote_package_test.go:12: 10 true<br>
— PASS: TestConcurrentMap (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch11/client">cs.liangjiajia.com/ch11/client</a>  1.148s</p>
</blockquote>
<h2 id="并发编程">并发编程</h2>
<h3 id="协程机制">协程机制</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\groutine</i></p>
<p><code>groutine_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGroutine</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> {</span><br><span class="line">			fmt.Println(i)</span><br><span class="line">		}(i)</span><br><span class="line">	}</span><br><span class="line">	time.Sleep(time.Millisecond * <span class="number">50</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestGroutine<br>
0<br>
3<br>
2<br>
5<br>
4<br>
6<br>
7<br>
8<br>
9<br>
1<br>
— PASS: TestGroutine (0.06s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/groutine">cs.liangjiajia.com/ch12/groutine</a>        (cached)</p>
</blockquote>
<h3 id="共享内存机制">共享内存机制</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\share_memery</i><br>
<code>share_memery.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCounter</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	counter := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ {</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">			counter++</span><br><span class="line">		}()</span><br><span class="line">	}</span><br><span class="line">	time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">	t.Logf(<span class="string">"counter = %d"</span>, counter)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestCounter<br>
h:\go_learning\src\ch12\share_memory\share_memery_test.go:17: counter = 4942<br>
— PASS: TestCounter (1.02s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/share_memory">cs.liangjiajia.com/ch12/share_memory</a>    6.647s</p>
</blockquote>
<p>在这个例子中，每个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 都试图递增一个共享的<code>counter</code>变量。由于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutines</mtext></mrow><annotation encoding="application/x-tex">\text {goroutines}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutines</span></span></span></span></span> 并发执行，它们可能会同时访问和修改<code>counter</code>变量，导致竞争条件（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Race&nbsp;Condition</mtext></mrow><annotation encoding="application/x-tex">\text {Race Condition}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Race&nbsp;Condition</span></span></span></span></span>）。不同的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 可能在不同的时间点并发地执行<code>counter++</code>操作。最终的<code>counter</code>值就不再是预期的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5000</mn></mrow><annotation encoding="application/x-tex">5000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span></span>。</p>
<p><code>share_memery.go</code>：解决方法，使用<b>互斥锁（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Mutex</mtext></mrow><annotation encoding="application/x-tex">\text {Mutex}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Mutex</span></span></span></span></span>）</b>来保护<code>counter</code>变量，确保同一时间只有一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 可以访问。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCounterThreadSafe</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> mut sync.Mutex</span><br><span class="line">	counter := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ {</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">			<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">				mut.Unlock()</span><br><span class="line">			}()</span><br><span class="line">			mut.Lock()</span><br><span class="line">			counter++</span><br><span class="line">		}()</span><br><span class="line">	}</span><br><span class="line">	time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">	t.Logf(<span class="string">"counter = %d"</span>, counter)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestCounterThreadSafe<br>
h:\go_learning\src\ch12\share_memory\share_memery_test.go:33: counter = 5000<br>
— PASS: TestCounterThreadSafe (1.01s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/share_memory">cs.liangjiajia.com/ch12/share_memory</a>    1.054s</p>
</blockquote>
<p><code>share_memery.go</code>：<code>time.Sleep(1 * time.Second)</code>被用来等待足够的时间，以确保所有启动的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutines</mtext></mrow><annotation encoding="application/x-tex">\text {goroutines}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutines</span></span></span></span></span> 都有机会执行递增操作，从而在最终打印计数器值之前完成。在这个例子中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutines</mtext></mrow><annotation encoding="application/x-tex">\text {goroutines}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutines</span></span></span></span></span> 是并发执行的，执行时间是不确定的，因此在主 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span>（测试函数）继续执行之前，使用<code>Sleep</code>来等待一秒钟，以确保足够的时间让其他 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutines</mtext></mrow><annotation encoding="application/x-tex">\text {goroutines}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutines</span></span></span></span></span> 完成它们的递增操作。需要注意的是，使用<code>Sleep</code>并不是一种理想的等待方式，因为它不能保证所有的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutines</mtext></mrow><annotation encoding="application/x-tex">\text {goroutines}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutines</span></span></span></span></span> 都已经完成。更好的做法是使用<b>等待组（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>WaitGroup</mtext></mrow><annotation encoding="application/x-tex">\text {WaitGroup}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">WaitGroup</span></span></span></span></span>）</b>等并发控制机制，这样可以更精确地等待所有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutines</mtext></mrow><annotation encoding="application/x-tex">\text {goroutines}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutines</span></span></span></span></span> 完成后再继续执行。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCounterWaitGroup</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> mut sync.Mutex</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	counter := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ {</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">			<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">				mut.Unlock()</span><br><span class="line">			}()</span><br><span class="line">			mut.Lock()</span><br><span class="line">			counter++</span><br><span class="line">			wg.Done()</span><br><span class="line">		}()</span><br><span class="line">	}</span><br><span class="line">	wg.Wait()</span><br><span class="line">	t.Logf(<span class="string">"counter = %d"</span>, counter)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestCounterWaitGroup<br>
h:\go_learning\src\ch12\share_memory\share_memery_test.go:52: counter = 5000<br>
— PASS: TestCounterWaitGroup (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/share_memory">cs.liangjiajia.com/ch12/share_memory</a>    5.661s</p>
</blockquote>
<h3 id="csp并发机制">CSP并发机制</h3>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Go</mtext></mrow><annotation encoding="application/x-tex">\text {Go}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Go</span></span></span></span></span> 语言通过 <b><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>CSP</mtext></mrow><annotation encoding="application/x-tex">\text {CSP}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">CSP</span></span></span></span></span>（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Communicating&nbsp;Sequential&nbsp;Processes</mtext></mrow><annotation encoding="application/x-tex">\text {Communicating Sequential Processes}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Communicating&nbsp;Sequential&nbsp;Processes</span></span></span></span></span>）</b> 并发模型来实现并发编程。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>CSP</mtext></mrow><annotation encoding="application/x-tex">\text {CSP}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">CSP</span></span></span></span></span> 是一种并发编程的范式，强调通过在不同执行体 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 之间传递消息进行通信，而不是通过共享内存来进行数据共享。</p>
<p>核心组件：</p>
<p><b><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span>（协程）</b>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Go</mtext></mrow><annotation encoding="application/x-tex">\text {Go}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Go</span></span></span></span></span> 语言中轻量级的并发执行单元，可以看作是一个独立的执行线程。使用<code>go</code>关键字可以启动一个新的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span>，它和主 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 并发执行。由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Go</mtext></mrow><annotation encoding="application/x-tex">\text {Go}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Go</span></span></span></span></span> 运行时系统调度，而不是由操作系统调度，创建和切换成本相对较低。</p>
<p><b><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>channel</mtext></mrow><annotation encoding="application/x-tex">\text {channel}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">channel</span></span></span></span></span>（通道）</b>：用于在不同goroutines之间传递数据的管道。通道可以是带缓冲的（缓冲通道）或非缓冲的。带缓冲通道允许在发送和接收之间有一定的缓冲空间，而非缓冲通道要求发送和接收同时准备好。通过使用通道，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutines</mtext></mrow><annotation encoding="application/x-tex">\text {goroutines}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutines</span></span></span></span></span> 可以安全地进行数据传递，避免了显式的锁和共享内存的复杂性。</p>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\async_service</i></p>
<p><code>async_service_test.go</code>：串行输出</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">service</span><span class="params">()</span></span> <span class="type">string</span> {</span><br><span class="line">	time.Sleep(time.Millisecond * <span class="number">50</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"Done"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">otherTask</span><span class="params">()</span></span> {</span><br><span class="line">	fmt.Println(<span class="string">"working on something else"</span>)</span><br><span class="line">	time.Sleep(time.Millisecond * <span class="number">100</span>)</span><br><span class="line">	fmt.Println(<span class="string">"Task is done."</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestService</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	fmt.Println(service())</span><br><span class="line">	otherTask()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestService<br>
Done<br>
working on something else<br>
Task is done.<br>
— PASS: TestService (0.17s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/async_service">cs.liangjiajia.com/ch12/async_service</a>   5.886s</p>
</blockquote>
<p><code>async_service_test.go</code>：并行控制</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AsyncService</span><span class="params">()</span></span> <span class="keyword">chan</span> <span class="type">string</span> {</span><br><span class="line">	retCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		ret := service()</span><br><span class="line">		fmt.Println(<span class="string">"returned result."</span>)</span><br><span class="line">		retCh &lt;- ret</span><br><span class="line">		fmt.Println(<span class="string">"service exited."</span>)</span><br><span class="line">	}()</span><br><span class="line">	<span class="keyword">return</span> retCh</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAsynService</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	retCh := AsyncService()</span><br><span class="line">	otherTask()</span><br><span class="line">	fmt.Println(&lt;-retCh)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestAsynService<br>
working on something else<br>
returned result.<br>
Task is done.<br>
Done<br>
service exited.<br>
— PASS: TestAsynService (0.10s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/async_service">cs.liangjiajia.com/ch12/async_service</a>   5.777s</p>
</blockquote>
<p>执行过程：</p>
<ol>
<li>
<p><code>TestAsyncService</code> 开始执行，启动主 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span>；</p>
</li>
<li>
<p><code>AsyncService</code> 被调用，启动一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span>。在这个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 中，<code>service</code>被调用 ，休眠 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn></mrow><annotation encoding="application/x-tex">50</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">0</span></span></span></span> ms；</p>
</li>
<li>
<p><code>otherTask</code>被调用，启动一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span>。在这个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 中，打印"<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>working&nbsp;on&nbsp;something&nbsp;else</mtext></mrow><annotation encoding="application/x-tex">\text {working on something else}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">working&nbsp;on&nbsp;something&nbsp;else</span></span></span></span></span>"，休眠 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn></mrow><annotation encoding="application/x-tex">100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span> ms；</p>
</li>
<li>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn></mrow><annotation encoding="application/x-tex">50</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">0</span></span></span></span> 毫秒后，<code>service</code>完成，打印"<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>returned&nbsp;result.</mtext></mrow><annotation encoding="application/x-tex">\text {returned result.}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">returned&nbsp;result.</span></span></span></span></span>"，将 “<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Done</mtext></mrow><annotation encoding="application/x-tex">\text {Done}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Done</span></span></span></span></span>” 通过通道传递给主 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span>；</p>
</li>
</ol>
<p>另外的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn></mrow><annotation encoding="application/x-tex">100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span> 毫秒后，<code>otherTask</code>完成，打印"<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Task&nbsp;is&nbsp;done.</mtext></mrow><annotation encoding="application/x-tex">\text {Task is done.}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Task&nbsp;is&nbsp;done.</span></span></span></span></span>"。</p>
<ol start="5">
<li>
<p>主 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 从通道中接收到"<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Done</mtext></mrow><annotation encoding="application/x-tex">\text {Done}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Done</span></span></span></span></span>"，打印"<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Done</mtext></mrow><annotation encoding="application/x-tex">\text {Done}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Done</span></span></span></span></span>"；</p>
</li>
<li>
<p><code>AsyncService</code>中的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 继续执行，打印 “<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>service&nbsp;exited.</mtext></mrow><annotation encoding="application/x-tex">\text {service exited.}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">service&nbsp;exited.</span></span></span></span></span>”。</p>
</li>
</ol>
<p><code>service</code>中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine</span></span></span></span></span> 会发生堵塞，直到接收 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>channel</mtext></mrow><annotation encoding="application/x-tex">\text {channel}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">channel</span></span></span></span></span>。</p>
<p><code>async_service_test.go</code>：稍作修改</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AsyncService</span><span class="params">()</span></span> <span class="keyword">chan</span> <span class="type">string</span> {</span><br><span class="line">	retCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		ret := service()</span><br><span class="line">		fmt.Println(<span class="string">"returned result."</span>)</span><br><span class="line">		retCh &lt;- ret</span><br><span class="line">		fmt.Println(<span class="string">"service exited."</span>)</span><br><span class="line">	}()</span><br><span class="line">	<span class="keyword">return</span> retCh</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAsynService</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	retCh := AsyncService()</span><br><span class="line">	otherTask()</span><br><span class="line">	fmt.Println(&lt;-retCh)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestAsynService<br>
working on something else<br>
returned result.<br>
service exited.<br>
Task is done.<br>
Done<br>
— PASS: TestAsynService (0.11s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/async_service">cs.liangjiajia.com/ch12/async_service</a>   (cached)</p>
</blockquote>
<h3 id="多路选择和超时控制">多路选择和超时控制</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\select_case</i></p>
<p><code>select_case_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AsyncService</span><span class="params">()</span></span> <span class="keyword">chan</span> <span class="type">string</span> {</span><br><span class="line">	retCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		ret := service()</span><br><span class="line">		fmt.Println(<span class="string">"returned result."</span>)</span><br><span class="line">		retCh &lt;- ret</span><br><span class="line">		fmt.Println(<span class="string">"service exited."</span>)</span><br><span class="line">	}()</span><br><span class="line">	<span class="keyword">return</span> retCh</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSelect</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">select</span> {</span><br><span class="line">	<span class="keyword">case</span> ret := &lt;-AsyncService():</span><br><span class="line">		t.Log(ret)</span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(time.Millisecond * <span class="number">100</span>):</span><br><span class="line">		t.Error(<span class="string">"time out"</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>select_case_test.go</code>：设置<code>service</code>等待时间为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn></mrow><annotation encoding="application/x-tex">50</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">0</span></span></span></span> ms</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">service</span><span class="params">()</span></span> <span class="type">string</span> {</span><br><span class="line">	time.Sleep(time.Millisecond * <span class="number">50</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"Done"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSelect<br>
returned result.<br>
service exited.<br>
h:\go_learning\src\ch12\select_case\select_case_test.go:28: Done<br>
— PASS: TestSelect (0.06s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/select_case">cs.liangjiajia.com/ch12/select_case</a>     5.687s</p>
</blockquote>
<p><code>select_case_test.go</code>：设置<code>service</code>等待时间为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>500</mn></mrow><annotation encoding="application/x-tex">500</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span></span></span></span> ms</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">service</span><span class="params">()</span></span> <span class="type">string</span> {</span><br><span class="line">	time.Sleep(time.Millisecond * <span class="number">500</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"Done"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSelect<br>
h:\go_learning\src\ch12\select_case\select_case_test.go:30: time out<br>
— FAIL: TestSelect (0.10s)<br>
FAIL<br>
FAIL    <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/select_case">cs.liangjiajia.com/ch12/select_case</a>     5.778s</p>
</blockquote>
<h3 id="channel的关闭和消息广播">Channel的关闭和消息广播</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\channel</i></p>
<p><code>channel_close_test.go</code>：单个接收者</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dataProducer</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">int</span>, wg *sync.WaitGroup)</span></span> {</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">			ch &lt;- i</span><br><span class="line">		}</span><br><span class="line">		wg.Done()</span><br><span class="line">	}()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dataReceiver</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">int</span>, wg *sync.WaitGroup)</span></span> {</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">			data := &lt;-ch</span><br><span class="line">			fmt.Println(data)</span><br><span class="line">		}</span><br><span class="line">		wg.Done()</span><br><span class="line">	}()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCloseChannel</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	dataProducer(ch, &amp;wg)</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	dataReceiver(ch, &amp;wg)</span><br><span class="line">	wg.Wait()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestCloseChannel<br>
0<br>
1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
7<br>
8<br>
9<br>
— PASS: TestCloseChannel (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/channel">cs.liangjiajia.com/ch12/channel</a> 1.640s</p>
</blockquote>
<p><code>channel_close_test.go</code>：多个接收者</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dataProducer</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">int</span>, wg *sync.WaitGroup)</span></span> {</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">			ch &lt;- i</span><br><span class="line">		}</span><br><span class="line">		<span class="built_in">close</span>(ch)</span><br><span class="line">		wg.Done()</span><br><span class="line">	}()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dataReceiverCorrection</span><span class="params">(ch <span class="keyword">chan</span> <span class="type">int</span>, wg *sync.WaitGroup)</span></span> {</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		<span class="keyword">for</span> {</span><br><span class="line">			<span class="keyword">if</span> data, ok := &lt;-ch; ok {</span><br><span class="line">				fmt.Println(data)</span><br><span class="line">			} <span class="keyword">else</span> {</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		wg.Done()</span><br><span class="line">	}()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCloseChannel</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	dataProducer(ch, &amp;wg)</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	dataReceiverCorrection(ch, &amp;wg)</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	dataReceiverCorrection(ch, &amp;wg)</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	dataReceiverCorrection(ch, &amp;wg)</span><br><span class="line">	wg.Wait()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestCloseChannel<br>
0<br>
2<br>
3<br>
4<br>
1<br>
6<br>
7<br>
8<br>
9<br>
5<br>
— PASS: TestCloseChannel (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/channel">cs.liangjiajia.com/ch12/channel</a> 1.440s</p>
</blockquote>
<h3 id="普通任务取消">普通任务取消</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\cancel</i></p>
<p><code>cancel_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cancel</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isCancelled</span><span class="params">(cancelChan <span class="keyword">chan</span> <span class="keyword">struct</span>{})</span></span> <span class="type">bool</span> {</span><br><span class="line">	<span class="keyword">select</span> {</span><br><span class="line">	<span class="keyword">case</span> &lt;-cancelChan:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>1⃣</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>cancel_test.go</code>：发送空消息</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cancel_1 sends a cancellation signal to the provided channel.</span></span><br><span class="line"><span class="comment">// It does so by sending an empty struct to the channel.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cancel_1</span><span class="params">(cancelChan <span class="keyword">chan</span> <span class="keyword">struct</span>{})</span></span> {</span><br><span class="line">	cancelChan &lt;- <span class="keyword">struct</span>{}{}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCancel</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	cancelChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>{}, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ {</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>, cancelChan <span class="keyword">chan</span> <span class="keyword">struct</span>{})</span></span> {</span><br><span class="line">			<span class="keyword">for</span> {</span><br><span class="line">				<span class="keyword">if</span> isCancelled(cancelChan) {</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				}</span><br><span class="line">				time.Sleep(time.Millisecond * <span class="number">5</span>)</span><br><span class="line">			}</span><br><span class="line">			fmt.Println(i, <span class="string">"Cancelled"</span>)</span><br><span class="line">		}(i, cancelChan)</span><br><span class="line">	}</span><br><span class="line">	cancel_1(cancelChan)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestCancel<br>
4 Cancelled<br>
— PASS: TestCancel (1.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/cancel">cs.liangjiajia.com/ch12/cancel</a>  6.779s</p>
</blockquote>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>2⃣</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><code>cancel_test.go</code>：关闭通道</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cancel_2 sends a cancellation signal to the provided channel.</span></span><br><span class="line"><span class="comment">// It does so by closing the channel.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cancel_2</span><span class="params">(cancelChan <span class="keyword">chan</span> <span class="keyword">struct</span>{})</span></span> {</span><br><span class="line">	<span class="built_in">close</span>(cancelChan)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCancel</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	cancelChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>{}, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ {</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>, cancelChan <span class="keyword">chan</span> <span class="keyword">struct</span>{})</span></span> {</span><br><span class="line">			<span class="keyword">for</span> {</span><br><span class="line">				<span class="keyword">if</span> isCancelled(cancelChan) {</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				}</span><br><span class="line">				time.Sleep(time.Millisecond * <span class="number">5</span>)</span><br><span class="line">			}</span><br><span class="line">			fmt.Println(i, <span class="string">"Cancelled"</span>)</span><br><span class="line">		}(i, cancelChan)</span><br><span class="line">	}</span><br><span class="line">	cancel_2(cancelChan)</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestCancel<br>
4 Cancelled<br>
0 Cancelled<br>
1 Cancelled<br>
2 Cancelled<br>
3 Cancelled<br>
— PASS: TestCancel (1.01s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/cancel">cs.liangjiajia.com/ch12/cancel</a>  6.547s</p>
</blockquote>
<h3 id="关联任务取消">关联任务取消</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\cancel</i></p>
<p><code>cancel_by_context_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isCancelledContext</span><span class="params">(ctx context.Context)</span></span> <span class="type">bool</span> {</span><br><span class="line">	<span class="keyword">select</span> {</span><br><span class="line">	<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCancelByContext</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ {</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>, ctx context.Context)</span></span> {</span><br><span class="line">			<span class="keyword">for</span> {</span><br><span class="line">				<span class="keyword">if</span> isCancelledContext(ctx) {</span><br><span class="line">					<span class="keyword">break</span></span><br><span class="line">				}</span><br><span class="line">				time.Sleep(time.Millisecond * <span class="number">5</span>)</span><br><span class="line">			}</span><br><span class="line">			fmt.Println(i, <span class="string">"Cancelled"</span>)</span><br><span class="line">		}(i, ctx)</span><br><span class="line">	}</span><br><span class="line">	cancel()</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="典型并发任务">典型并发任务</h2>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\concurrent_tasks</i></p>
<h3 id="单例模式">单例模式</h3>
<p><code>singleton\singleton_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Singleton <span class="keyword">struct</span> {</span><br><span class="line">	data <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> singleInstance *Singleton</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetSingletonObj</span><span class="params">()</span></span> *Singleton {</span><br><span class="line">	once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		fmt.Println(<span class="string">"Create Obj"</span>)</span><br><span class="line">		singleInstance = <span class="built_in">new</span>(Singleton)</span><br><span class="line">	})</span><br><span class="line">	<span class="keyword">return</span> singleInstance</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetSingletonObj</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">			obj := GetSingletonObj()</span><br><span class="line">			fmt.Printf(<span class="string">"%X\n"</span>, unsafe.Pointer(obj))</span><br><span class="line">			wg.Done()</span><br><span class="line">		}()</span><br><span class="line">	}</span><br><span class="line">	wg.Wait()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestGetSingletonObj<br>
Create Obj<br>
C00008A000<br>
C00008A000<br>
C00008A000<br>
C00008A000<br>
C00008A000<br>
C00008A000<br>
C00008A000<br>
C00008A000<br>
C00008A000<br>
C00008A000<br>
— PASS: TestGetSingletonObj (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/concurrent_tasks/singleton">cs.liangjiajia.com/ch12/concurrent_tasks/singleton</a>      1.778s</p>
</blockquote>
<h3 id="返回第一个">返回第一个</h3>
<p><code>first_response\first_response_test.go</code>：多个任务的并发执行，但只等待第一个返回的结果。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runTask</span><span class="params">(id <span class="type">int</span>)</span></span> <span class="type">string</span> {</span><br><span class="line">	time.Sleep(<span class="number">10</span> * time.Millisecond)</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"The result is from %d"</span>, id)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FirstResponse</span><span class="params">()</span></span> <span class="type">string</span> {</span><br><span class="line">	numOfRunner := <span class="number">10</span></span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, numOfRunner)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numOfRunner; i++ {</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> {</span><br><span class="line">			ret := runTask(i)</span><br><span class="line">			ch &lt;- ret</span><br><span class="line">		}(i)</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> &lt;-ch</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFirstResponse</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	t.Log(FirstResponse())</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestFirstResponse<br>
h:\go_learning\src\ch12\concurrent_tasks\first_response\first_response_test.go:27: The result is from 9<br>
— PASS: TestFirstResponse (0.02s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/concurrent_tasks/first_response">cs.liangjiajia.com/ch12/concurrent_tasks/first_response</a> 5.685s</p>
</blockquote>
<h3 id="完成所有任务">完成所有任务</h3>
<p><code>all_response\all_response_test.go</code>：多个任务的并发执行，等待所有返回的结果。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runTask</span><span class="params">(id <span class="type">int</span>)</span></span> <span class="type">string</span> {</span><br><span class="line">	time.Sleep(<span class="number">10</span> * time.Millisecond)</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"The result is from %d"</span>, id)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AllResponse</span><span class="params">()</span></span> <span class="type">string</span> {</span><br><span class="line">	numOfRunner := <span class="number">10</span></span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, numOfRunner)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numOfRunner; i++ {</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> {</span><br><span class="line">			ret := runTask(i)</span><br><span class="line">			ch &lt;- ret</span><br><span class="line">		}(i)</span><br><span class="line">	}</span><br><span class="line">	finalRet := <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; numOfRunner; j++ {</span><br><span class="line">		finalRet += <span class="string">"\n"</span> + &lt;-ch</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> finalRet</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFirstResponse</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	t.Log(AllResponse())</span><br><span class="line">	time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestFirstResponse<br>
h:\go_learning\src\ch12\concurrent_tasks\all_response\all_response_test.go:32:<br>
The result is from 1<br>
The result is from 6<br>
The result is from 9<br>
The result is from 7<br>
The result is from 0<br>
The result is from 4<br>
The result is from 5<br>
The result is from 3<br>
The result is from 2<br>
The result is from 8<br>
— PASS: TestFirstResponse (1.02s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/concurrent_tasks/all_response">cs.liangjiajia.com/ch12/concurrent_tasks/all_response</a>   6.766s</p>
</blockquote>
<h2 id="对象池">对象池</h2>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\object_pool</i></p>
<p><code>obj_pool.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReusableObj <span class="keyword">struct</span> {</span><br><span class="line">	<span class="comment">// Structure for reusable objects</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ObjPool <span class="keyword">struct</span> {</span><br><span class="line">	bufChan <span class="keyword">chan</span> *ReusableObj <span class="comment">// Channel for buffering reusable objects</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewObjPool creates an object pool, initializes, and fills it with a specified number of reusable objects</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewObjPool</span><span class="params">(numOfObj <span class="type">int</span>)</span></span> *ObjPool {</span><br><span class="line">	objPool := ObjPool{}</span><br><span class="line">	objPool.bufChan = <span class="built_in">make</span>(<span class="keyword">chan</span> *ReusableObj, numOfObj)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numOfObj; i++ {</span><br><span class="line">		objPool.bufChan &lt;- &amp;ReusableObj{} <span class="comment">// Put a pointer to a reusable object into the channel</span></span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> &amp;objPool</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetObj retrieves a reusable object from the object pool with a specified timeout; returns an error if timed out</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(objPool *ObjPool)</span></span> GetObj(timeout time.Duration) (*ReusableObj, <span class="type">error</span>) {</span><br><span class="line">	<span class="keyword">select</span> {</span><br><span class="line">	<span class="keyword">case</span> ret := &lt;-objPool.bufChan:</span><br><span class="line">		<span class="keyword">return</span> ret, <span class="literal">nil</span> <span class="comment">// Return if there is a reusable object in the channel</span></span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(timeout): <span class="comment">// Return a timeout error if timed out</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">"time out"</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReleaseObj puts an object back into the object pool; returns an error if the pool is full</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(objPool *ObjPool)</span></span> ReleaseObj(obj *ReusableObj) <span class="type">error</span> {</span><br><span class="line">	<span class="keyword">select</span> {</span><br><span class="line">	<span class="keyword">case</span> objPool.bufChan &lt;- obj:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span> <span class="comment">// Return nil if successful (object released)</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"overflow"</span>) <span class="comment">// Return an overflow error if the channel is full</span></span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>obj_pool_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestObjPool</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	pool := NewObjPool(<span class="number">10</span>)</span><br><span class="line">	useCount := <span class="number">15</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; useCount; i++ {</span><br><span class="line">		<span class="keyword">if</span> v, err := pool.GetObj(time.Second * <span class="number">1</span>); err != <span class="literal">nil</span> {</span><br><span class="line">			t.Error(err)</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			fmt.Println(&amp;v)</span><br><span class="line">			<span class="keyword">if</span> err := pool.ReleaseObj(v); err != <span class="literal">nil</span> {</span><br><span class="line">				t.Error(err)</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	fmt.Println(<span class="string">"Done"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestObjPool<br>
0xc00000a068<br>
0xc00000a070<br>
0xc00000a078<br>
0xc00000a080<br>
0xc00000a088<br>
0xc00000a090<br>
0xc00000a098<br>
0xc00000a0a0<br>
0xc00000a0a8<br>
0xc00000a0b0<br>
0xc00000a0b8<br>
0xc00000a0c0<br>
0xc00000a0c8<br>
0xc00000a0d0<br>
0xc00000a0d8<br>
Done<br>
— PASS: TestObjPool (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/object_pool">cs.liangjiajia.com/ch12/object_pool</a>     1.435s</p>
</blockquote>
<h2 id="sysc-pool-对象缓存">sysc.Pool 对象缓存</h2>
<p>对象获取：</p>
<ol>
<li>尝试从私有对象获取</li>
<li>尝试从当前 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Processor</mtext></mrow><annotation encoding="application/x-tex">\text {Processor}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Processor</span></span></span></span></span> 共享池获取</li>
<li>尝试从其他 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Processor</mtext></mrow><annotation encoding="application/x-tex">\text {Processor}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Processor</span></span></span></span></span> 共享池获取</li>
<li>用户指定 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>New</mtext></mrow><annotation encoding="application/x-tex">\text {New}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">New</span></span></span></span></span> 函数产生新的对象</li>
</ol>
<p>对象放回：</p>
<ol>
<li>保存为私有对象</li>
<li>保存为当前 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Processor</mtext></mrow><annotation encoding="application/x-tex">\text {Processor}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Processor</span></span></span></span></span> 共享池</li>
</ol>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch12\object_cache</i></p>
<p><code>sysnc_pool_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSyncPool</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	pool := &amp;sync.Pool{</span><br><span class="line">		New: <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">interface</span>{} {</span><br><span class="line">			fmt.Println(<span class="string">"Create a new object."</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">		},</span><br><span class="line">	}</span><br><span class="line">	v1 := pool.Get().(<span class="type">int</span>)</span><br><span class="line">	fmt.Println(v1)</span><br><span class="line">	pool.Put(<span class="number">2023</span>)</span><br><span class="line">	v2, _ := pool.Get().(<span class="type">int</span>)</span><br><span class="line">	fmt.Println(v2)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSyncPool<br>
Create a new object.<br>
100<br>
2023<br>
— PASS: TestSyncPool (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/object_cache">cs.liangjiajia.com/ch12/object_cache</a>    (cached)</p>
</blockquote>
<p><code>sysnc_pool_test.go</code>：添加<code>runtime.GC()</code>：官方 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Go&nbsp;runtime&nbsp;1.13</mtext></mrow><annotation encoding="application/x-tex">\text {Go runtime 1.13}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Go&nbsp;runtime&nbsp;1.13</span></span></span></span></span> 将对sync.Pool中的对象回收时机策略做出调整。在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.12</mn></mrow><annotation encoding="application/x-tex">1.12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span><span class="mord">2</span></span></span></span> 版本及以前的版本中，在每轮垃圾回收过程中，每个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>sync.Pool</mtext></mrow><annotation encoding="application/x-tex">\text {sync.Pool}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">sync.Pool</span></span></span></span></span> 实例中的所有缓存对象都将被无条件回收掉。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSyncPool</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	pool := &amp;sync.Pool{</span><br><span class="line">		New: <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">interface</span>{} {</span><br><span class="line">			fmt.Println(<span class="string">"Create a new object."</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">		},</span><br><span class="line">	}</span><br><span class="line">	v1 := pool.Get().(<span class="type">int</span>)</span><br><span class="line">	fmt.Println(v1)</span><br><span class="line">	pool.Put(<span class="number">2023</span>)</span><br><span class="line">	runtime.GC()</span><br><span class="line">	v2, _ := pool.Get().(<span class="type">int</span>)</span><br><span class="line">	fmt.Println(v2)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSyncPool<br>
Create a new object.<br>
100<br>
2023<br>
— PASS: TestSyncPool (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/object_cache">cs.liangjiajia.com/ch12/object_cache</a>    (cached)</p>
</blockquote>
<p><code>sysnc_pool_test.go</code>：从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>1.13</mtext></mrow><annotation encoding="application/x-tex">\text {1.13}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">1.13</span></span></span></span></span> 版本开始，如果一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>sync.Pool</mtext></mrow><annotation encoding="application/x-tex">\text {sync.Pool}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">sync.Pool</span></span></span></span></span> 实例在上一轮垃圾回收过程结束之后仍然被使用过，则其中的缓存对象将不会被回收掉。此举对于使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>sync.Pool</mtext></mrow><annotation encoding="application/x-tex">\text {sync.Pool}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">sync.Pool</span></span></span></span></span> 来提升效率的程序来说，将大大减少周期性的因为缓存被清除而造成的瞬时效率下降。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSyncPool</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	pool := &amp;sync.Pool{</span><br><span class="line">		New: <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">interface</span>{} {</span><br><span class="line">			fmt.Println(<span class="string">"Create a new object."</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">		},</span><br><span class="line">	}</span><br><span class="line">	v1 := pool.Get().(<span class="type">int</span>)</span><br><span class="line">	fmt.Println(v1)</span><br><span class="line">	pool.Put(<span class="number">2023</span>)</span><br><span class="line">	runtime.GC()</span><br><span class="line">	runtime.GC()</span><br><span class="line">	v2, _ := pool.Get().(<span class="type">int</span>)</span><br><span class="line">	fmt.Println(v2)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSyncPool<br>
Create a new object.<br>
100<br>
Create a new object.<br>
100<br>
— PASS: TestSyncPool (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/object_cache">cs.liangjiajia.com/ch12/object_cache</a>    (cached)</p>
</blockquote>
<p><code>sysnc_pool_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSyncPoolInMultiGroutine</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	pool := &amp;sync.Pool{</span><br><span class="line">		New: <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">interface</span>{} {</span><br><span class="line">			fmt.Println(<span class="string">"Create a new object."</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">		},</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	pool.Put(<span class="number">100</span>)</span><br><span class="line">	pool.Put(<span class="number">100</span>)</span><br><span class="line">	pool.Put(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ {</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(id <span class="type">int</span>)</span></span> {</span><br><span class="line">			fmt.Println(pool.Get())</span><br><span class="line">			wg.Done()</span><br><span class="line">		}(i)</span><br><span class="line">	}</span><br><span class="line">	wg.Wait()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSyncPoolInMultiGroutine<br>
100<br>
100<br>
100<br>
Create a new object.<br>
10<br>
Create a new object.<br>
10<br>
Create a new object.<br>
10<br>
Create a new object.<br>
10<br>
Create a new object.<br>
10<br>
Create a new object.<br>
10<br>
Create a new object.<br>
10<br>
— PASS: TestSyncPoolInMultiGroutine (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch12/object_cache">cs.liangjiajia.com/ch12/object_cache</a>    0.037s</p>
</blockquote>
<h2 id="测试">测试</h2>
<h3 id="单元测试">单元测试</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch13\unit_test</i></p>
<p><code>square.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">square</span><span class="params">(op <span class="type">int</span>)</span></span> <span class="type">int</span> {</span><br><span class="line">	<span class="keyword">return</span> op * op</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>square_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSquare</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	inputs := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">	expected := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>}</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(inputs); i++ {</span><br><span class="line">		ret := square(inputs[i])</span><br><span class="line">		<span class="keyword">if</span> ret != expected[i] {</span><br><span class="line">			t.Errorf(<span class="string">"input is %d, the expected is %d, the actual %d"</span>, inputs[i], expected[i], ret)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSquare<br>
— PASS: TestSquare (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch13/unit_test">cs.liangjiajia.com/ch13/unit_test</a>       1.270s</p>
</blockquote>
<p><code>Fail</code>，<code>Error</code>：测试失败，测试继续，其他测试继续执行。</p>
<p><code>FailNow</code>，<code>Fatal</code>：测试失败，测试终止，其他测试继续执行。</p>
<p><code>square_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestErrorInCode</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	fmt.Println(<span class="string">"Start"</span>)</span><br><span class="line">	t.Error(<span class="string">"Error"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"End"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFailInCode</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	fmt.Println(<span class="string">"Start"</span>)</span><br><span class="line">	t.Fatal(<span class="string">"Error"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"End"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<div align="center">
  <img src="../../../images/programming-language/go/2.png" style="zoom:50%;">
</div>
<blockquote>
<p>=== RUN   TestSquare<br>
— PASS: TestSquare (0.00s)<br>
=== RUN   TestErrorInCode<br>
Start<br>
h:\go_learning\src\ch13\unit_test\square_test.go:21: Error<br>
End<br>
— FAIL: TestErrorInCode (0.00s)<br>
=== RUN   TestFailInCode<br>
Start<br>
h:\go_learning\src\ch13\unit_test\square_test.go:27: Error<br>
— FAIL: TestFailInCode (0.00s)<br>
FAIL<br>
FAIL    <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch13/unit_test">cs.liangjiajia.com/ch13/unit_test</a>       1.415s</p>
</blockquote>
<h3 id="断言">断言</h3>
<p><code>go get -u github.com/stretchr/testify/assert</code></p>
<div align="center">
  <img src="../../../images/programming-language/go/3.png" style="zoom:50%;">
</div>
`square_test.go`：
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSquareWithAssert</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	inputs := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">	expected := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>}</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(inputs); i++ {</span><br><span class="line">		ret := square(inputs[i])</span><br><span class="line">		assert.Equal(t, expected[i], ret)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestSquareWithAssert<br>
— PASS: TestSquareWithAssert (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch13/unit_test">cs.liangjiajia.com/ch13/unit_test</a>       0.940s</p>
</blockquote>
<p>发生错误的情况</p>
<blockquote>
<p>=== RUN   TestSquareWithAssert<br>
h:\go_learning\src\ch13\unit_test\square_test.go:38:<br>
Error Trace:    h:/go_learning/src/ch13/unit_test/square_test.go:38<br>
Error:          Not equal:<br>
expected: 10<br>
actual  : 9<br>
Test:           TestSquareWithAssert<br>
— FAIL: TestSquareWithAssert (0.00s)<br>
FAIL<br>
FAIL    <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch13/unit_test">cs.liangjiajia.com/ch13/unit_test</a>       1.819s</p>
</blockquote>
<h3 id="benchmark">Benchmark</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch13\benchmark</i></p>
<p><code>concat_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestConcatStringByAdd</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	assert := assert.New(t)</span><br><span class="line">	elems := []<span class="type">string</span>{<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>}</span><br><span class="line">	ret := <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> _, elem := <span class="keyword">range</span> elems {</span><br><span class="line">		ret += elem</span><br><span class="line">	}</span><br><span class="line">	assert.Equal(<span class="string">"12345"</span>, ret)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestConcatStringByBytesBuffer</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	assert := assert.New()</span><br><span class="line">	<span class="keyword">var</span> buf bytes.Buffer</span><br><span class="line">	elems := []<span class="type">string</span>{<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>}</span><br><span class="line">	<span class="keyword">for</span> _, elem := <span class="keyword">range</span> elems {</span><br><span class="line">		buf.WriteString(elem)</span><br><span class="line">	}</span><br><span class="line">	assert.Equal(<span class="string">"12345"</span>, buf.String())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkConcatStringByAdd</span><span class="params">(b *testing.B)</span></span> {</span><br><span class="line">	elems := []<span class="type">string</span>{<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>}</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ {</span><br><span class="line">		ret := <span class="string">""</span></span><br><span class="line">		<span class="keyword">for</span> _, elem := <span class="keyword">range</span> elems {</span><br><span class="line">			ret += elem</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	b.StopTimer()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkConcatStringByBytesBuffer</span><span class="params">(b *testing.B)</span></span> {</span><br><span class="line">	elems := []<span class="type">string</span>{<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>}</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ {</span><br><span class="line">		<span class="keyword">var</span> buf bytes.Buffer</span><br><span class="line">		<span class="keyword">for</span> _, elem := <span class="keyword">range</span> elems {</span><br><span class="line">			buf.WriteString(elem)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	b.StopTimer()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>go test -bench="."</code></p>
<blockquote>
<p>goos: windows<br>
goarch: amd64<br>
pkg: <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch13/benchmark">cs.liangjiajia.com/ch13/benchmark</a><br>
cpu: Intel® Core™ i7-9750H CPU @ 2.60GHz<br>
BenchmarkConcatStringByAdd-12                   11036227               105.3 ns/op<br>
BenchmarkConcatStringByBytesBuffer-12           21769615                54.71 ns/op<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch13/benchmark">cs.liangjiajia.com/ch13/benchmark</a>       4.115s</p>
</blockquote>
<p><code>go test -bench="." -benchmem</code></p>
<blockquote>
<p>goos: windows<br>
goarch: amd64<br>
pkg: <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch13/benchmark">cs.liangjiajia.com/ch13/benchmark</a><br>
cpu: Intel® Core™ i7-9750H CPU @ 2.60GHz<br>
BenchmarkConcatStringByAdd-12                   11269498               108.7 ns/op            16 B/op          4 allocs/op<br>
BenchmarkConcatStringByBytesBuffer-12           19745870                56.24 ns/op           64 B/op          1 allocs/op<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch13/benchmark">cs.liangjiajia.com/ch13/benchmark</a>       2.554s</p>
</blockquote>
<h3 id="bdd-behavior-driven-development">BDD-Behavior Driven Development</h3>
<p><code>go get -u github.com/smartystreets/goconvey/convey</code></p>
<div align="center">
  <img src="../../../images/programming-language/go/4.png" style="zoom:50%;">
</div>
<span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch13\bdd</i>
<p><code>bdd_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSpec</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	convey.Convey(<span class="string">"Given 2 even numbers"</span>, t, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">		a := <span class="number">3</span></span><br><span class="line">		b := <span class="number">4</span></span><br><span class="line">		convey.Convey(<span class="string">"When add the two numbers"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">			c := a + b</span><br><span class="line">			convey.Convey(<span class="string">"Then the result is still even"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">				convey.So(c%<span class="number">2</span>, convey.ShouldEqual, <span class="number">0</span>)</span><br><span class="line">			})</span><br><span class="line">		})</span><br><span class="line">	})</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="反射">反射</h2>
<p><code>reflect.TypeOf</code>返回类型<code>reflect.Type</code></p>
<p><code>reflect.ValueOf</code>返回值<code>reflect.Value</code></p>
<p>判断类型：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Kind <span class="type">uint</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Invalid Kind = <span class="literal">iota</span></span><br><span class="line">	Bool</span><br><span class="line">	Int</span><br><span class="line">	Int8</span><br><span class="line">	Int16</span><br><span class="line">	Int32</span><br><span class="line">	Int64</span><br><span class="line">	Uint</span><br><span class="line">	Uint8</span><br><span class="line">	Uint16</span><br><span class="line">	Uint32</span><br><span class="line">	Uint64</span><br><span class="line">	Uintptr</span><br><span class="line">	Float32</span><br><span class="line">	Float64</span><br><span class="line">	Complex64</span><br><span class="line">	Complex128</span><br><span class="line">	Array</span><br><span class="line">	Chan</span><br><span class="line">	Func</span><br><span class="line">	Interface</span><br><span class="line">	Map</span><br><span class="line">	Pointer</span><br><span class="line">	Slice</span><br><span class="line">	String</span><br><span class="line">	Struct</span><br><span class="line">	UnsafePointer</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch14\reflect</i></p>
<p><code>reflect_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestTypeAndValue</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> f <span class="type">int64</span> = <span class="number">10</span></span><br><span class="line">	t.Log(reflect.TypeOf(f), reflect.ValueOf(f))</span><br><span class="line">	t.Log(reflect.ValueOf(f).Type())</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestTypeAndValue<br>
h:\go_learning\src\ch14\reflect\reflect_test.go:11: int64 10<br>
h:\go_learning\src\ch14\reflect\reflect_test.go:12: int64<br>
— PASS: TestTypeAndValue (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch14/reflect">cs.liangjiajia.com/ch14/reflect</a> 0.040s</p>
</blockquote>
<p><code>reflect_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CheckType</span><span class="params">(v <span class="keyword">interface</span>{})</span></span> {</span><br><span class="line">	t := reflect.TypeOf(v)</span><br><span class="line">	<span class="keyword">switch</span> t.Kind() {</span><br><span class="line">	<span class="keyword">case</span> reflect.Float32, reflect.Float64:</span><br><span class="line">		fmt.Println(<span class="string">"Float"</span>)</span><br><span class="line">	<span class="keyword">case</span> reflect.Int, reflect.Int32, reflect.Int64:</span><br><span class="line">		fmt.Println(<span class="string">"Integer"</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">"Unknown"</span>, t)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestBasicType</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	<span class="keyword">var</span> f <span class="type">float64</span> = <span class="number">12</span></span><br><span class="line">	CheckType(f)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestBasicType<br>
Float<br>
— PASS: TestBasicType (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch14/reflect">cs.liangjiajia.com/ch14/reflect</a> 1.529s</p>
</blockquote>
<p>利用反射编写灵活的代码：</p>
<ul>
<li>按名字访问结构的成员：<code>reflect.ValueOf(*e).FieldByName("XXX")</code></li>
<li>按名字访问结构的方法：<code>reflect.ValueOf(e).MethodByName("XXX").Call([]reflect.Value{reflect.ValueOf(x)})</code></li>
</ul>
<p><code>reflect_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> {</span><br><span class="line">	EmployeeID <span class="type">string</span></span><br><span class="line">	Name       <span class="type">string</span> <span class="string">`format:"normal"`</span></span><br><span class="line">	Age        <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Employee)</span></span> UpdateAge(newVal <span class="type">int</span>) {</span><br><span class="line">	e.Age = newVal</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestInvokeByName</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	e := &amp;Employee{<span class="string">"1"</span>, <span class="string">"Mike"</span>, <span class="number">30</span>}</span><br><span class="line">	t.Logf(<span class="string">"Name: value(%[1]v), Type(%[1]T) "</span>, reflect.ValueOf(*e).FieldByName(<span class="string">"Name"</span>))</span><br><span class="line">	<span class="keyword">if</span> nameField, ok := reflect.TypeOf(*e).FieldByName(<span class="string">"Name"</span>); !ok {</span><br><span class="line">		t.Error(<span class="string">"Failed to get 'Name' field."</span>)</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		t.Log(<span class="string">"Tag:format"</span>, nameField.Tag.Get(<span class="string">"format"</span>))</span><br><span class="line">	}</span><br><span class="line">	reflect.ValueOf(e).MethodByName(<span class="string">"UpdateAge"</span>).Call([]reflect.Value{reflect.ValueOf(<span class="number">18</span>)})</span><br><span class="line">	t.Log(<span class="string">"Updated Age:"</span>, e)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestInvokeByName<br>
h:\go_learning\src\ch14\reflect\reflect_test.go:44: Name: value(Mike), Type(reflect.Value)<br>
h:\go_learning\src\ch14\reflect\reflect_test.go:48: Tag:format normal<br>
h:\go_learning\src\ch14\reflect\reflect_test.go:51: Updated Age: &amp;{1 Mike 18}<br>
— PASS: TestInvokeByName (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch14/reflect">cs.liangjiajia.com/ch14/reflect</a> (cached)</p>
</blockquote>
<h3 id="万能程序">万能程序</h3>
<p><code>reflect_deepequal_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Customer <span class="keyword">struct</span> {</span><br><span class="line">	CookieID <span class="type">string</span></span><br><span class="line">	Name     <span class="type">string</span></span><br><span class="line">	Age      <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestDeepEqual</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	a := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>{<span class="number">1</span>: <span class="string">"one"</span>, <span class="number">2</span>: <span class="string">"two"</span>, <span class="number">3</span>: <span class="string">"three"</span>}</span><br><span class="line">	b := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>{<span class="number">1</span>: <span class="string">"one"</span>, <span class="number">2</span>: <span class="string">"two"</span>, <span class="number">3</span>: <span class="string">"three"</span>}</span><br><span class="line">	t.Log(<span class="string">"a==b?"</span>, reflect.DeepEqual(a, b))</span><br><span class="line"></span><br><span class="line">	s1 := []<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">	s2 := []<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">	s3 := []<span class="type">int</span>{<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>}</span><br><span class="line">	t.Log(<span class="string">"s1 == s2?"</span>, reflect.DeepEqual(s1, s2))</span><br><span class="line">	t.Log(<span class="string">"s1 == s3?"</span>, reflect.DeepEqual(s1, s3))</span><br><span class="line"></span><br><span class="line">	c1 := Customer{<span class="string">"1"</span>, <span class="string">"Mike"</span>, <span class="number">40</span>}</span><br><span class="line">	c2 := Customer{<span class="string">"1"</span>, <span class="string">"Mike"</span>, <span class="number">40</span>}</span><br><span class="line">	t.Log(<span class="string">"c1 == c2?"</span>, reflect.DeepEqual(c1, c2))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestDeepEqual<br>
h:\go_learning\src\ch14\reflect\reflect_deepequal_test.go:17: a==b? true<br>
h:\go_learning\src\ch14\reflect\reflect_deepequal_test.go:22: s1 == s2? true<br>
h:\go_learning\src\ch14\reflect\reflect_deepequal_test.go:23: s1 == s3? false<br>
h:\go_learning\src\ch14\reflect\reflect_deepequal_test.go:27: c1 == c2? true<br>
— PASS: TestDeepEqual (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch14/reflect">cs.liangjiajia.com/ch14/reflect</a> 1.636s</p>
</blockquote>
<p><code>reflect_deepequal_test.go</code>：我们可以观察到<code>Employee</code>类和<code>Customer</code>类结构一致，所以可以在值一样的情况下完成填充</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fillBySettings</span><span class="params">(st <span class="keyword">interface</span>{}, settings <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>{})</span></span> <span class="type">error</span> {</span><br><span class="line">	<span class="comment">// 检查 st 是一个指针</span></span><br><span class="line">	<span class="keyword">if</span> reflect.TypeOf(st).Kind() != reflect.Ptr {</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"The first param should be a pointer to the struct type."</span>)</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">// 检查 st 指针所指向的类型是结构体</span></span><br><span class="line">	<span class="keyword">if</span> reflect.TypeOf(st).Elem().Kind() != reflect.Struct {</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"The first param should be a pointer to the struct type."</span>)</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> settings == <span class="literal">nil</span> {</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"Settings is nil."</span>)</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		field reflect.StructField</span><br><span class="line">		ok    <span class="type">bool</span></span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> settings {</span><br><span class="line">		<span class="keyword">if</span> field, ok = (reflect.ValueOf(st)).Elem().Type().FieldByName(k); !ok {</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> field.Type == reflect.TypeOf(v) {</span><br><span class="line">			vstr := reflect.ValueOf(st)</span><br><span class="line">			vstr = vstr.Elem()</span><br><span class="line">			vstr.FieldByName(k).Set(reflect.ValueOf(v))</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFillNameAndAge</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	settings := <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>{}{<span class="string">"Name"</span>: <span class="string">"Mike"</span>, <span class="string">"Age"</span>: <span class="number">30</span>}</span><br><span class="line">	e := Employee{}</span><br><span class="line">	<span class="keyword">if</span> err := fillBySettings(&amp;e, settings); err != <span class="literal">nil</span> {</span><br><span class="line">		t.Fatal(err)</span><br><span class="line">	}</span><br><span class="line">	t.Log(e)</span><br><span class="line">	c := <span class="built_in">new</span>(Customer)</span><br><span class="line">	<span class="keyword">if</span> err := fillBySettings(c, settings); err != <span class="literal">nil</span> {</span><br><span class="line">		t.Fatal(err)</span><br><span class="line">	}</span><br><span class="line">	t.Log(*c)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestFillNameAndAge<br>
h:\go_learning\src\ch14\reflect\reflect_deepequal_test.go:66: { Mike 30}<br>
h:\go_learning\src\ch14\reflect\reflect_deepequal_test.go:71: { Mike 30}<br>
— PASS: TestFillNameAndAge (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch14/reflect">cs.liangjiajia.com/ch14/reflect</a> 1.825s</p>
</blockquote>
<h2 id="常见架构模式实现">常见架构模式实现</h2>
<h3 id="pipe-filter">pipe-filter</h3>
<div align="center">
  <img src="../../../images/programming-language/go/5.png" style="zoom:50%;">
</div>
<span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch15\framework</i>
<p><code>filter.go</code>定义：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Request is the input of the filter</span></span><br><span class="line"><span class="keyword">type</span> Request <span class="keyword">interface</span>{}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Response is the output of the filter</span></span><br><span class="line"><span class="keyword">type</span> Response <span class="keyword">interface</span>{}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Filter interface is the definition of the data processing components</span></span><br><span class="line"><span class="comment">// Pipe-Filter structure</span></span><br><span class="line"><span class="keyword">type</span> Filter <span class="keyword">interface</span> {</span><br><span class="line">	Process(data Request) (Response, <span class="type">error</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>split_filter.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> SplitFilterWrongFormatError = errors.New(<span class="string">"Input data should be string"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SplitFilter <span class="keyword">struct</span> {</span><br><span class="line">	delimiter <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSplitFilter</span><span class="params">(delimiter <span class="type">string</span>)</span></span> *SplitFilter {</span><br><span class="line">	<span class="keyword">return</span> &amp;SplitFilter{delimiter}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sf *SplitFilter)</span></span> Process(data Request) (Response, <span class="type">error</span>) {</span><br><span class="line">	str, ok := data.(<span class="type">string</span>)</span><br><span class="line">	<span class="keyword">if</span> !ok {</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, SplitFilterWrongFormatError</span><br><span class="line">	}</span><br><span class="line">	parts := strings.Split(str, sf.delimiter)</span><br><span class="line">	<span class="keyword">return</span> parts, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>to_int_filter.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ToIntFilterWrongFormatError = errors.New(<span class="string">"Input data should be []string"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ToIntFilter <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewToIntFilter</span><span class="params">()</span></span> *ToIntFilter {</span><br><span class="line">	<span class="keyword">return</span> &amp;ToIntFilter{}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tif *ToIntFilter)</span></span> Process(data Request) (Response, <span class="type">error</span>) {</span><br><span class="line">	parts, ok := data.([]<span class="type">string</span>)</span><br><span class="line">	<span class="keyword">if</span> !ok {</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, ToIntFilterWrongFormatError</span><br><span class="line">	}</span><br><span class="line">	ret := []<span class="type">int</span>{}</span><br><span class="line">	<span class="keyword">for</span> _, part := <span class="keyword">range</span> parts {</span><br><span class="line">		s, err := strconv.Atoi(part)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		}</span><br><span class="line">		ret = <span class="built_in">append</span>(ret, s)</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>sum_filter.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> SumFilterWrongFormatError = errors.New(<span class="string">"Input data should be []int"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SumFilter <span class="keyword">struct</span> {</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSumFilter</span><span class="params">()</span></span> *SumFilter {</span><br><span class="line">	<span class="keyword">return</span> &amp;SumFilter{}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sf *SumFilter)</span></span> Process(data Request) (Response, <span class="type">error</span>) {</span><br><span class="line">	elems, ok := data.([]<span class="type">int</span>)</span><br><span class="line">	<span class="keyword">if</span> !ok {</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, SumFilterWrongFormatError</span><br><span class="line">	}</span><br><span class="line">	ret := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, elem := <span class="keyword">range</span> elems {</span><br><span class="line">		ret += elem</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>straigt_pipeline.go</code>：整合形成</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NewStraightPipeline create a new StraightPipelineWithWallTime</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStraightPipeline</span><span class="params">(name <span class="type">string</span>, filters ...Filter)</span></span> *StraightPipeline {</span><br><span class="line">	<span class="keyword">return</span> &amp;StraightPipeline{</span><br><span class="line">		Name:    name,</span><br><span class="line">		Filters: &amp;filters,</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// StraightPipeline is composed of the filters, and the filters are piled as a straigt line.</span></span><br><span class="line"><span class="keyword">type</span> StraightPipeline <span class="keyword">struct</span> {</span><br><span class="line">	Name    <span class="type">string</span></span><br><span class="line">	Filters *[]Filter</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Process is to process the coming data by the pipeline</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *StraightPipeline)</span></span> Process(data Request) (Response, <span class="type">error</span>) {</span><br><span class="line">	<span class="keyword">var</span> ret <span class="keyword">interface</span>{}</span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	<span class="keyword">for</span> _, filter := <span class="keyword">range</span> *f.Filters {</span><br><span class="line">		ret, err = filter.Process(data)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">			<span class="keyword">return</span> ret, err</span><br><span class="line">		}</span><br><span class="line">		data = ret</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> ret, err</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>pipefilter_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStraightPipeline</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	split_filter := NewSplitFilter(<span class="string">","</span>)</span><br><span class="line">	to_int_filter := NewToIntFilter()</span><br><span class="line">	sum_filter := NewSumFilter()</span><br><span class="line">	sp := NewStraightPipeline(<span class="string">"calculate"</span>, split_filter, to_int_filter, sum_filter)</span><br><span class="line">	ret, err := sp.Process(<span class="string">"1,2,3"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		t.Fatal(err)</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> ret != <span class="number">6</span> {</span><br><span class="line">		t.Fatalf(<span class="string">"The expected is 6, but the actual is %d"</span>, ret)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestStraightPipeline<br>
— PASS: TestStraightPipeline (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch15/framework/pipe_filter">cs.liangjiajia.com/ch15/framework/pipe_filter</a>   1.404s</p>
</blockquote>
<h3 id="micro-kernel">micro-kernel</h3>
<h2 id="常见任务">常见任务</h2>
<h3 id="json">JSON</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch16\task\json</i></p>
<p><code>struct_def.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> BasicInfo <span class="keyword">struct</span> {</span><br><span class="line">	Name <span class="type">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">	Age  <span class="type">int</span>    <span class="string">`json:"age"`</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> JobInfo <span class="keyword">struct</span> {</span><br><span class="line">	Skills []<span class="type">string</span> <span class="string">`json:"skills"`</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> {</span><br><span class="line">	BasicInfo BasicInfo <span class="string">`json:"basic_info"`</span></span><br><span class="line">	JobInfo   JobInfo   <span class="string">`json:"job_info"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jsonStr = <span class="string">`{</span></span><br><span class="line"><span class="string">	"basic_info":{</span></span><br><span class="line"><span class="string">	  	"name":"Mike",</span></span><br><span class="line"><span class="string">		"age":30</span></span><br><span class="line"><span class="string">	},</span></span><br><span class="line"><span class="string">	"job_info":{</span></span><br><span class="line"><span class="string">		"skills":["Java","Go","C"]</span></span><br><span class="line"><span class="string">	}</span></span><br><span class="line"><span class="string">}	`</span></span><br></pre></td></tr></tbody></table></figure>
<p><code>embedded_json_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestEmbeddedJson</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	e := <span class="built_in">new</span>(Employee)</span><br><span class="line">	err := json.Unmarshal([]<span class="type">byte</span>(jsonStr), e)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		t.Error(err)</span><br><span class="line">	}</span><br><span class="line">	fmt.Println(*e)</span><br><span class="line">	<span class="keyword">if</span> v, err := json.Marshal(e); err == <span class="literal">nil</span> {</span><br><span class="line">		fmt.Println(<span class="type">string</span>(v))</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		t.Error(err)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestEmbeddedJson<br>
{ {Mike 30} {[Java Go C]} }<br>
{“basic_info”:{“name”:“Mike”,“age”:30},“job_info”:{“skills”:[“Java”,“Go”,“C”]}}<br>
— PASS: TestEmbeddedJson (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch16/task/json">cs.liangjiajia.com/ch16/task/json</a>       1.437s</p>
</blockquote>
<h4 id="easyjson">easyjson</h4>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cd</mtext></mrow><annotation encoding="application/x-tex">\text {cd}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">cd</span></span></span></span></span> 至 <i>src\ch16</i>，执行</p>
<p><code>go get -u github.com/mailru/easyjson &amp; go install github.com/mailru/easyjson/...@latest</code></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cd</mtext></mrow><annotation encoding="application/x-tex">\text {cd}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">cd</span></span></span></span></span> 至 <i>src\ch16\task\json</i>，执行</p>
<p><code>~\go\bin\easyjson -all struct_def.go</code></p>
<p>自动生成<code>struct_def_easyjson.go</code>文件</p>
<p><code>easy_json_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestEasyJson</span><span class="params">(t *testing.T)</span></span> {</span><br><span class="line">	e := Employee{}</span><br><span class="line">	e.UnmarshalJSON([]<span class="type">byte</span>(jsonStr))</span><br><span class="line">	fmt.Println(e)</span><br><span class="line">	<span class="keyword">if</span> v, err := e.MarshalJSON(); err != <span class="literal">nil</span> {</span><br><span class="line">		t.Error(err)</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		fmt.Println(<span class="type">string</span>(v))</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>=== RUN   TestEasyJson<br>
{ {Mike 30} {[Java Go C]} }<br>
{“basic_info”:{“name”:“Mike”,“age”:30},“job_info”:{“skills”:[“Java”,“Go”,“C”]}}<br>
— PASS: TestEasyJson (0.00s)<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch16/task/json">cs.liangjiajia.com/ch16/task/json</a>       1.662s</p>
</blockquote>
<p><code>benchmark_json_test.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkEmbeddedJson</span><span class="params">(b *testing.B)</span></span> {</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	e := <span class="built_in">new</span>(Employee)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ {</span><br><span class="line"></span><br><span class="line">		err := json.Unmarshal([]<span class="type">byte</span>(jsonStr), e)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">			b.Error(err)</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> _, err = json.Marshal(e); err != <span class="literal">nil</span> {</span><br><span class="line">			b.Error(err)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkEasyJson</span><span class="params">(b *testing.B)</span></span> {</span><br><span class="line">	b.ResetTimer()</span><br><span class="line">	e := Employee{}</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ {</span><br><span class="line">		err := e.UnmarshalJSON([]<span class="type">byte</span>(jsonStr))</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">			b.Error(err)</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> _, err = e.MarshalJSON(); err != <span class="literal">nil</span> {</span><br><span class="line">			b.Error(err)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cd</mtext></mrow><annotation encoding="application/x-tex">\text {cd}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">cd</span></span></span></span></span> 至 <i>src\ch16\task\json</i>，执行</p>
<p><code>go test -bench="."</code></p>
<blockquote>
<p>{ {Mike 30} {[Java Go C]} }<br>
{“basic_info”:{“name”:“Mike”,“age”:30},“job_info”:{“skills”:[“Java”,“Go”,“C”]}}<br>
{ {Mike 30} {[Java Go C]} }<br>
{“basic_info”:{“name”:“Mike”,“age”:30},“job_info”:{“skills”:[“Java”,“Go”,“C”]}}<br>
goos: windows<br>
goarch: amd64<br>
pkg: <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch16/task/json">cs.liangjiajia.com/ch16/task/json</a><br>
cpu: Intel® Core™ i7-9750H CPU @ 2.60GHz<br>
BenchmarkEmbeddedJson-12          530538              2283 ns/op<br>
BenchmarkEasyJson-12             1568922               717.6 ns/op<br>
PASS<br>
ok      <a target="_blank" rel="noopener" href="http://cs.liangjiajia.com/ch16/task/json">cs.liangjiajia.com/ch16/task/json</a>       3.182s</p>
</blockquote>
<h3 id="http">HTTP</h3>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>src\ch16\task\http</i></p>
<p><code>hello_http.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">		fmt.Fprintf(w, <span class="string">"Hello World!"</span>)</span><br><span class="line">	})</span><br><span class="line">	http.HandleFunc(<span class="string">"/time/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br><span class="line">		t := time.Now()</span><br><span class="line">		timeStr := fmt.Sprintf(<span class="string">"{\"time\": \"%s\"}"</span>, t)</span><br><span class="line">		w.Write([]<span class="type">byte</span>(timeStr))</span><br><span class="line">	})</span><br><span class="line"></span><br><span class="line">	http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a></p>
<div align="center">
  <img src="../../../images/programming-language/go/6.png" style="zoom:33%;">
</div>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/time/">http://127.0.0.1:8080/time/</a></p>
<div align="center">
  <img src="../../../images/programming-language/go/7.png" style="zoom:33%;">
</div>
<h4 id="restful">restful</h4>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cd</mtext></mrow><annotation encoding="application/x-tex">\text {cd}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">cd</span></span></span></span></span> 至 <i>src\ch16</i>，执行</p>
<p><code>go get -u github.com/julienschmidt/httprouter</code></p>
<p><code>http_router\http_router_http.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/julienschmidt/httprouter"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(w http.ResponseWriter, r *http.Request, _ httprouter.Params)</span></span> {</span><br><span class="line">	fmt.Fprint(w, <span class="string">"Welcome!\n"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span><span class="params">(w http.ResponseWriter, r *http.Request, ps httprouter.Params)</span></span> {</span><br><span class="line">	fmt.Fprintf(w, <span class="string">"hello, %s!\n"</span>, ps.ByName(<span class="string">"name"</span>))</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	router := httprouter.New()</span><br><span class="line">	router.GET(<span class="string">"/"</span>, Index)</span><br><span class="line">	router.GET(<span class="string">"/hello/:name"</span>, Hello)</span><br><span class="line"></span><br><span class="line">	log.Fatal(http.ListenAndServe(<span class="string">":8080"</span>, router))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a></p>
<div align="center">
  <img src="../../../images/programming-language/go/8.png" style="zoom:33%;">
</div>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/hello/:solisamicus">http://127.0.0.1:8080/hello/:solisamicus</a></p>
<div align="center">
  <img src="../../../images/programming-language/go/9.png" style="zoom:33%;">
</div>
<p><code>restful\restful_http.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> {</span><br><span class="line">	ID   <span class="type">string</span> <span class="string">`json:"id"`</span></span><br><span class="line">	Name <span class="type">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">	Age  <span class="type">int</span>    <span class="string">`json:"age"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> employeeDB <span class="keyword">map</span>[<span class="type">string</span>]*Employee</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> {</span><br><span class="line">	employeeDB = <span class="keyword">map</span>[<span class="type">string</span>]*Employee{}</span><br><span class="line">	employeeDB[<span class="string">"Mike"</span>] = &amp;Employee{<span class="string">"e-1"</span>, <span class="string">"Mike"</span>, <span class="number">35</span>}</span><br><span class="line">	employeeDB[<span class="string">"Rose"</span>] = &amp;Employee{<span class="string">"e-2"</span>, <span class="string">"Rose"</span>, <span class="number">45</span>}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(w http.ResponseWriter, r *http.Request, _ httprouter.Params)</span></span> {</span><br><span class="line">	fmt.Fprint(w, <span class="string">"Welcome!\n"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetEmployeeByName</span><span class="params">(w http.ResponseWriter, r *http.Request, ps httprouter.Params)</span></span> {</span><br><span class="line">	qName := ps.ByName(<span class="string">"name"</span>)</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		ok       <span class="type">bool</span></span><br><span class="line">		info     *Employee</span><br><span class="line">		infoJson []<span class="type">byte</span></span><br><span class="line">		err      <span class="type">error</span></span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> info, ok = employeeDB[qName]; !ok {</span><br><span class="line">		w.Write([]<span class="type">byte</span>(<span class="string">"{\"error\":\"Not Found\"}"</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">if</span> infoJson, err = json.Marshal(info); err != <span class="literal">nil</span> {</span><br><span class="line">		w.Write([]<span class="type">byte</span>(fmt.Sprintf(<span class="string">"{\"error\":,\"%s\"}"</span>, err)))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	}</span><br><span class="line">	w.Write(infoJson)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	router := httprouter.New()</span><br><span class="line">	router.GET(<span class="string">"/"</span>, Index)</span><br><span class="line">	router.GET(<span class="string">"/employee/:name"</span>, GetEmployeeByName)</span><br><span class="line"></span><br><span class="line">	log.Fatal(http.ListenAndServe(<span class="string">":8080"</span>, router))</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a></p>
<div align="center">
  <img src="../../../images/programming-language/go/10.png" style="zoom:33%;">
</div>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8080/employee/Mike">http://127.0.0.1:8080/employee/Mike</a></p>
<div align="center">
  <img src="../../../images/programming-language/go/11.png" style="zoom:33%;">
</div>
<h2 id="性能调优">性能调优</h2>
<h3 id="graphviz">graphviz</h3>
<p>官网：<a target="_blank" rel="noopener" href="https://www.graphviz.org/">https://www.graphviz.org/</a></p>
<p>下载：<a target="_blank" rel="noopener" href="https://graphviz.org/download/">https://graphviz.org/download/</a></p>
<h3 id="flamegraph">flamegraph</h3>
<p>下载并复制 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>flamegraph.pl</mtext></mrow><annotation encoding="application/x-tex">\text {flamegraph.pl}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">flamegraph.pl</span></span></span></span></span>（<a target="_blank" rel="noopener" href="https://github.com/brendangregg/FlameGraph/blob/master/flamegraph.pl%EF%BC%89%E8%87%B3">https://github.com/brendangregg/FlameGraph/blob/master/flamegraph.pl）至</a> <span class="katex-error" title="ParseError: KaTeX parse error: Undefined control sequence: \bin at position 16: \text {\$GOPATH\̲b̲i̲n̲}">\text {\$GOPATH\bin}</span></p>
<h3 id="go-torch">go-torch</h3>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>go-torch</mtext></mrow><annotation encoding="application/x-tex">\text {go-torch}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">go-torch</span></span></span></span></span> 是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Uber</mtext></mrow><annotation encoding="application/x-tex">\text {Uber}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Uber</span></span></span></span></span>公司开源的一款针对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Golang</mtext></mrow><annotation encoding="application/x-tex">\text {Golang}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Golang</span></span></span></span></span> 程序的火焰图生成工具，能收集 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>stack&nbsp;traces</mtext></mrow><annotation encoding="application/x-tex">\text {stack traces}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">stack&nbsp;traces</span></span></span></span></span>，并把它们整理成火焰图，直观地呈现给开发人员。</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cd</mtext></mrow><annotation encoding="application/x-tex">\text {cd}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">cd</span></span></span></span></span> 至 <i>src\ch17</i>，执行</p>
<p><code>go get -u github.com/uber/go-torch &amp;&amp; go install github.com/uber/go-torch@latest</code></p>
<p><span class="github-emoji" style="display:inline;vertical-align:middle"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><i>​src\ch17\tools</i></p>
<p><code>prof.go</code>：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"runtime/pprof"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	col = <span class="number">10000</span></span><br><span class="line">	row = <span class="number">10000</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// fillMatrix 用随机数填充二维数组</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fillMatrix</span><span class="params">(m *[row][col]<span class="type">int</span>)</span></span> {</span><br><span class="line">	s := rand.New(rand.NewSource(time.Now().UnixNano()))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; row; i++ {</span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; col; j++ {</span><br><span class="line">			m[i][j] = s.Intn(<span class="number">100000</span>)</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// calculate 计算二维数组每行的和</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculate</span><span class="params">(m *[row][col]<span class="type">int</span>)</span></span> {</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; row; i++ {</span><br><span class="line">		tmp := <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; col; j++ {</span><br><span class="line">			tmp += m[i][j]</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">	<span class="comment">// CPU Profile 输出文件</span></span><br><span class="line">	f, err := os.Create(<span class="string">"cpu.prof"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		log.Fatal(<span class="string">"Could not create CPU profile: "</span>, err)</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">defer</span> f.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// CPU Profile</span></span><br><span class="line">	<span class="keyword">if</span> err := pprof.StartCPUProfile(f); err != <span class="literal">nil</span> {</span><br><span class="line">		log.Fatal(<span class="string">"Could not start CPU profile: "</span>, err)</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">defer</span> pprof.StopCPUProfile()</span><br><span class="line"></span><br><span class="line">	x := [row][col]<span class="type">int</span>{}</span><br><span class="line">	fillMatrix(&amp;x)</span><br><span class="line">	calculate(&amp;x)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Memory Profile 输出文件</span></span><br><span class="line">	f1, err := os.Create(<span class="string">"mem.prof"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		log.Fatal(<span class="string">"Could not create memory profile: "</span>, err)</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">defer</span> f1.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// runtime.GC()</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Memory Profile</span></span><br><span class="line">	<span class="keyword">if</span> err := pprof.WriteHeapProfile(f1); err != <span class="literal">nil</span> {</span><br><span class="line">		log.Fatal(<span class="string">"Could not write memory profile: "</span>, err)</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Goroutine Profile 输出文件</span></span><br><span class="line">	f2, err := os.Create(<span class="string">"goroutine.prof"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		log.Fatal(<span class="string">"Could not create goroutine profile: "</span>, err)</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">defer</span> f2.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Goroutine Profile</span></span><br><span class="line">	<span class="keyword">if</span> gProf := pprof.Lookup(<span class="string">"goroutine"</span>); gProf == <span class="literal">nil</span> {</span><br><span class="line">		log.Fatal(<span class="string">"Could not write goroutine profile: "</span>)</span><br><span class="line">	} <span class="keyword">else</span> {</span><br><span class="line">		gProf.WriteTo(f2, <span class="number">0</span>)</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ol>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cd</mtext></mrow><annotation encoding="application/x-tex">\text {cd}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">cd</span></span></span></span></span> 至 <i>src\ch17\tools</i>，执行</li>
</ol>
<p><code>go build prof.go</code></p>
<ol start="2">
<li>生成可执行文件 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>prof.exe</mtext></mrow><annotation encoding="application/x-tex">\text {prof.exe}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">prof.exe</span></span></span></span></span>，执行</li>
</ol>
<p><code>.\prof.exe</code></p>
<ol start="3">
<li>生成相关的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>prof</mtext></mrow><annotation encoding="application/x-tex">\text {prof}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">prof</span></span></span></span></span> 文件：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cpu.prof</mtext></mrow><annotation encoding="application/x-tex">\text {cpu.prof}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">cpu.prof</span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>mem.prof</mtext></mrow><annotation encoding="application/x-tex">\text {mem.prof}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">mem.prof</span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>goroutine.prof</mtext></mrow><annotation encoding="application/x-tex">\text {goroutine.prof}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">goroutine.prof</span></span></span></span></span>，执行</li>
</ol>
<p><code>go tool pprof prof cpu.prof</code></p>
<p>依次输入<code>top</code>，<code>list XXX</code>查看详细情况：</p>
<div align="center">
  <img src="../../../images/programming-language/go/12.png" style="zoom:50%;">
</div>
<p>分析：</p>
<p><code>top</code>：展示了运行时间最长的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span></span></span></span> 个函数，以及运行时间占总运行时间的百分比和累积时间。</p>
<table>
<thead>
<tr>
<th>指标</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>flat</mtext></mrow><annotation encoding="application/x-tex">\text {flat}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">flat</span></span></span></span></span></td>
<td>函数自身 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cpu</mtext></mrow><annotation encoding="application/x-tex">\text {cpu}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">cpu</span></span></span></span></span> 运行时间</td>
</tr>
<tr>
<td><span class="katex-error" title="ParseError: KaTeX parse error: Expected '}', got 'EOF' at end of input: \text {flat%}">\text {flat%}</span></td>
<td>函数自身运行时间占整个程序 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cpu</mtext></mrow><annotation encoding="application/x-tex">\text {cpu}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">cpu</span></span></span></span></span> 运行时间中所占的百分比</td>
</tr>
<tr>
<td><span class="katex-error" title="ParseError: KaTeX parse error: Expected '}', got 'EOF' at end of input: \text {sum%}">\text {sum%}</span></td>
<td>函数自身运行时间以及它调用的其他函数的运行时间占整个程序 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cpu</mtext></mrow><annotation encoding="application/x-tex">\text {cpu}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">cpu</span></span></span></span></span> 运行时间的累积百分比</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cum</mtext></mrow><annotation encoding="application/x-tex">\text {cum}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord text"><span class="mord">cum</span></span></span></span></span></td>
<td>函数自身运行时间以及它调用的其他函数的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cpu</mtext></mrow><annotation encoding="application/x-tex">\text {cpu}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">cpu</span></span></span></span></span> 运行时间的累积时间</td>
</tr>
<tr>
<td><span class="katex-error" title="ParseError: KaTeX parse error: Expected '}', got 'EOF' at end of input: \text {cum%}">\text {cum%}</span></td>
<td>函数自身运行时间以及它调用的其他函数的运行时间占整个程序 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cpu</mtext></mrow><annotation encoding="application/x-tex">\text {cpu}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">cpu</span></span></span></span></span> 运行时间的累积百分比</td>
</tr>
</tbody>
</table>
<p><code>list fillMatrix</code></p>
<table>
<thead>
<tr>
<th>指标</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>flat</mtext></mrow><annotation encoding="application/x-tex">\text {flat}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">flat</span></span></span></span></span></td>
<td>函数自身 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cpu</mtext></mrow><annotation encoding="application/x-tex">\text {cpu}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">cpu</span></span></span></span></span> 运行时间</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cum</mtext></mrow><annotation encoding="application/x-tex">\text {cum}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord text"><span class="mord">cum</span></span></span></span></span></td>
<td>函数自身运行时间以及它调用的其他函数的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>cpu</mtext></mrow><annotation encoding="application/x-tex">\text {cpu}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">cpu</span></span></span></span></span> 运行时间的累积时间</td>
</tr>
<tr>
<td>$\text</td>
<td></td>
</tr>
</tbody>
</table>
</i></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://solisamicus.github.io">SolisAmicus</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://solisamicus.github.io/programming-language/go/Go%20%E8%AF%AD%E8%A8%80%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/">https://solisamicus.github.io/programming-language/go/Go%20%E8%AF%AD%E8%A8%80%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://solisamicus.github.io" target="_blank">梁嘉嘉の博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Go/">Go</a></div><div class="post_share"><div class="social-share" data-image="/../../../images/programming-language/go/golang-logo.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/bug/j2cache-upgrade/" title="J2Cache Upgrade"><img class="cover" src="/../../images/bug/j2cache-upgrade/cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">J2Cache Upgrade</div></div></a></div><div class="next-post pull-right"><a href="/data-structures-and-algorithms/problems/%E6%9E%9A%E4%B8%BE%E7%AE%97%E6%B3%95/" title="枚举算法"><img class="cover" src="/../../../images/data-structures-and-algorithms/problems/%E6%9E%9A%E4%B8%BE_cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">枚举算法</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">SolisAmicus</div><div class="author-info__description">分享, 知识, 探索</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://solisamicus.github.io" target="_blank" title="Blog"><i class="fa-solid fa-blog"></i></a><a class="social-icon" href="https://github.com/SolisAmicus" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:solisamicus@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">如果阅读过程中遇到了问题，请及时评论或者留言，看到了会在第一时间给出回复。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E7%AC%AC%E4%B8%80%E4%B8%AA-go-%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.</span> <span class="toc-text">编写第一个 Go 程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">基本程序结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text">基本数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.2.</span> <span class="toc-text">运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.2.1.</span> <span class="toc-text">算术运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.2.2.</span> <span class="toc-text">比较运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.2.3.</span> <span class="toc-text">逻辑运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.2.4.</span> <span class="toc-text">位运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.3.</span> <span class="toc-text">条件语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.4.</span> <span class="toc-text">循环语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%9B%86%E5%90%88"><span class="toc-number">3.</span> <span class="toc-text">常用集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">3.1.</span> <span class="toc-text">数组</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%A3%B0%E6%98%8E"><span class="toc-number">3.1.1.</span> <span class="toc-text">数组声明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.1.2.</span> <span class="toc-text">数组初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%95%B0%E7%BB%84%E9%81%8D%E5%8E%86-%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87-%E6%95%B0%E7%BB%84%E6%89%A9%E5%AE%B9"><span class="toc-number">3.1.3.</span> <span class="toc-text">关于数组遍历，数组切片，数组扩容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map"><span class="toc-number">3.2.</span> <span class="toc-text">Map</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%AE%E4%B8%8D%E5%AD%98%E5%9C%A8"><span class="toc-number">3.2.1.</span> <span class="toc-text">键不存在</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#map%E9%81%8D%E5%8E%86"><span class="toc-number">3.2.2.</span> <span class="toc-text">Map遍历</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#map%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">3.2.3.</span> <span class="toc-text">Map增删改查</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">6.</span> <span class="toc-text">面向对象编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1"><span class="toc-number">6.1.</span> <span class="toc-text">类和对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.2.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.3.</span> <span class="toc-text">空接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.4.</span> <span class="toc-text">自定义类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%E5%A4%8D%E7%94%A8"><span class="toc-number">6.5.</span> <span class="toc-text">拓展复用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%80%81"><span class="toc-number">6.6.</span> <span class="toc-text">多态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E5%92%8C%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">包和依赖管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93"><span class="toc-number">8.1.</span> <span class="toc-text">使用第三方库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B"><span class="toc-number">9.</span> <span class="toc-text">并发编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E7%A8%8B%E6%9C%BA%E5%88%B6"><span class="toc-number">9.1.</span> <span class="toc-text">协程机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-number">9.2.</span> <span class="toc-text">共享内存机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#csp%E5%B9%B6%E5%8F%91%E6%9C%BA%E5%88%B6"><span class="toc-number">9.3.</span> <span class="toc-text">CSP并发机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%B7%AF%E9%80%89%E6%8B%A9%E5%92%8C%E8%B6%85%E6%97%B6%E6%8E%A7%E5%88%B6"><span class="toc-number">9.4.</span> <span class="toc-text">多路选择和超时控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#channel%E7%9A%84%E5%85%B3%E9%97%AD%E5%92%8C%E6%B6%88%E6%81%AF%E5%B9%BF%E6%92%AD"><span class="toc-number">9.5.</span> <span class="toc-text">Channel的关闭和消息广播</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E4%BB%BB%E5%8A%A1%E5%8F%96%E6%B6%88"><span class="toc-number">9.6.</span> <span class="toc-text">普通任务取消</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E4%BB%BB%E5%8A%A1%E5%8F%96%E6%B6%88"><span class="toc-number">9.7.</span> <span class="toc-text">关联任务取消</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B8%E5%9E%8B%E5%B9%B6%E5%8F%91%E4%BB%BB%E5%8A%A1"><span class="toc-number">10.</span> <span class="toc-text">典型并发任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">10.1.</span> <span class="toc-text">单例模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E7%AC%AC%E4%B8%80%E4%B8%AA"><span class="toc-number">10.2.</span> <span class="toc-text">返回第一个</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E6%89%80%E6%9C%89%E4%BB%BB%E5%8A%A1"><span class="toc-number">10.3.</span> <span class="toc-text">完成所有任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%B1%A0"><span class="toc-number">11.</span> <span class="toc-text">对象池</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sysc-pool-%E5%AF%B9%E8%B1%A1%E7%BC%93%E5%AD%98"><span class="toc-number">12.</span> <span class="toc-text">sysc.Pool 对象缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">13.</span> <span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">13.1.</span> <span class="toc-text">单元测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%AD%E8%A8%80"><span class="toc-number">13.2.</span> <span class="toc-text">断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#benchmark"><span class="toc-number">13.3.</span> <span class="toc-text">Benchmark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bdd-behavior-driven-development"><span class="toc-number">13.4.</span> <span class="toc-text">BDD-Behavior Driven Development</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84"><span class="toc-number">14.</span> <span class="toc-text">反射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E7%A8%8B%E5%BA%8F"><span class="toc-number">14.1.</span> <span class="toc-text">万能程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0"><span class="toc-number">15.</span> <span class="toc-text">常见架构模式实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pipe-filter"><span class="toc-number">15.1.</span> <span class="toc-text">pipe-filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#micro-kernel"><span class="toc-number">15.2.</span> <span class="toc-text">micro-kernel</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E4%BB%BB%E5%8A%A1"><span class="toc-number">16.</span> <span class="toc-text">常见任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#json"><span class="toc-number">16.1.</span> <span class="toc-text">JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#easyjson"><span class="toc-number">16.1.1.</span> <span class="toc-text">easyjson</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http"><span class="toc-number">16.2.</span> <span class="toc-text">HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#restful"><span class="toc-number">16.2.1.</span> <span class="toc-text">restful</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98"><span class="toc-number">17.</span> <span class="toc-text">性能调优</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#graphviz"><span class="toc-number">17.1.</span> <span class="toc-text">graphviz</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flamegraph"><span class="toc-number">17.2.</span> <span class="toc-text">flamegraph</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#go-torch"><span class="toc-number">17.3.</span> <span class="toc-text">go-torch</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/code/%E7%9F%B3%E5%AD%90%E5%BD%92%E5%B9%B6/" title="石子归并问题"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="石子归并问题"/></a><div class="content"><a class="title" href="/code/%E7%9F%B3%E5%AD%90%E5%BD%92%E5%B9%B6/" title="石子归并问题">石子归并问题</a><time datetime="2023-11-28T14:50:00.000Z" title="发表于 2023-11-28 22:50:00">2023-11-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/operating-system/Linux-Basis/" title="Linux 基础"><img src="/../../images/operating-system/linux/1_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux 基础"/></a><div class="content"><a class="title" href="/operating-system/Linux-Basis/" title="Linux 基础">Linux 基础</a><time datetime="2023-11-15T08:30:40.000Z" title="发表于 2023-11-15 16:30:40">2023-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/data-structures-and-algorithms/problems/%E6%90%9C%E7%B4%A2%E6%8A%80%E6%9C%AF/" title="搜索技术"><img src="/../../../images/data-structures-and-algorithms/problems/%E6%90%9C%E7%B4%A2%E6%8A%80%E6%9C%AF_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="搜索技术"/></a><div class="content"><a class="title" href="/data-structures-and-algorithms/problems/%E6%90%9C%E7%B4%A2%E6%8A%80%E6%9C%AF/" title="搜索技术">搜索技术</a><time datetime="2023-11-05T00:30:00.000Z" title="发表于 2023-11-05 08:30:00">2023-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/data-structures-and-algorithms/problems/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/" title="贪心算法"><img src="/../../../images/data-structures-and-algorithms/problems/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="贪心算法"/></a><div class="content"><a class="title" href="/data-structures-and-algorithms/problems/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/" title="贪心算法">贪心算法</a><time datetime="2023-11-04T00:30:00.000Z" title="发表于 2023-11-04 08:30:00">2023-11-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/data-structures-and-algorithms/problems/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" title="动态规划"><img src="/../../../images/data-structures-and-algorithms/problems/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92_cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="动态规划"/></a><div class="content"><a class="title" href="/data-structures-and-algorithms/problems/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" title="动态规划">动态规划</a><time datetime="2023-11-03T00:30:00.000Z" title="发表于 2023-11-03 08:30:00">2023-11-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="footer_custom_text">希望你的眼睛一直笑，想要的都能得到。<p><a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="Hexo框架"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="Butterfly主题"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="Gtihub托管"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>